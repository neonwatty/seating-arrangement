import{u as F,j as e,g as we,D as It,a as re,b as Rt,A as tt,c as Dt,d as Ht,e as Gt,s as ye,f as Et,Q as $t,h as Ae,i as st,k as Yt}from"./index-BuuUsEeF.js";import{r,a as nt,u as Xe}from"./react-vendor-DSgMQvCA.js";import{u as Lt,a as Pe,b as At,c as Je,D as Xt,d as Pt,T as Vt,P as Ot}from"./dnd-kit-CqfYIfUh.js";import{a as Bt,u as fe}from"./gesture-BYLw3qxJ.js";import{g as at}from"./groupColors-DijypUJV.js";import{G as qt}from"./GuestChip-C-SwfmLk.js";import{R as Wt,I as Ut,M as _t}from"./ImportWizard-CMSagWRr.js";import"./pdf-export-BqwfyxvF.js";import"./compression-B61UvNVp.js";import"./qrcode-CZEObl3k.js";import"./excel-import-eTqe3OYc.js";function Te({onLongPress:t,threshold:n=500,onTouchStart:s,onTouchEnd:d}){const c=r.useRef(null),a=r.useRef(null),h=r.useRef(!1),l=r.useCallback(()=>{c.current&&(clearTimeout(c.current),c.current=null),a.current=null},[]),o=r.useCallback(u=>{if(u.touches.length>1){l();return}h.current=!1;const j=u.touches[0];a.current={x:j.clientX,y:j.clientY},c.current=setTimeout(()=>{h.current=!0,t(u),"vibrate"in navigator&&navigator.vibrate(50)},n),s?.(u)},[t,n,s,l]),m=r.useCallback(u=>{l(),h.current&&u.preventDefault(),d?.(u)},[l,d]),p=r.useCallback(u=>{if(a.current&&u.touches.length===1){const j=u.touches[0],y=Math.abs(j.clientX-a.current.x),x=Math.abs(j.clientY-a.current.y);(y>10||x>10)&&l()}},[l]);return{onTouchStart:o,onTouchEnd:m,onTouchMove:p}}function Ft({guest:t,seatPosition:n,tablePosition:s,isSwapTarget:d}){const{setEditingGuest:c,openContextMenu:a,animatingGuestIds:h,clearAnimatingGuests:l,visibleGroups:o}=F(),m=h.has(t.id),p=t.group??"",u=o==="all"||o.has(p);r.useEffect(()=>{if(m){const N=setTimeout(()=>{l()},1500);return()=>clearTimeout(N)}},[m,l]);const{attributes:j,listeners:y,setNodeRef:x,isDragging:C}=Pe({id:t.id,data:{type:"seated-guest",guest:t,originalPosition:{canvasX:s.x+n.x,canvasY:s.y+n.y}}}),I=we(t),R=()=>{switch(t.rsvpStatus){case"confirmed":return"var(--color-success)";case"declined":return"var(--color-error)";default:return"var(--color-warning)"}},z=t.dietaryRestrictions&&t.dietaryRestrictions.length>0,Y=z?t.dietaryRestrictions.map(N=>It[N.toLowerCase()]||"").filter(Boolean)[0]||"ðŸ½ï¸":null,f=t.accessibilityNeeds&&t.accessibilityNeeds.length>0,k=at(t.group),b=[re(t)];t.group&&b.push(`Group: ${t.group}`),z&&b.push(`Diet: ${t.dietaryRestrictions.join(", ")}`),f&&b.push(`Accessibility: ${t.accessibilityNeeds.join(", ")}`);const T=N=>{N.stopPropagation(),c(t.id)},M=N=>{N.preventDefault(),N.stopPropagation(),a(N.clientX,N.clientY,"guest",t.id)},v=Te({onLongPress:N=>{N.preventDefault();const w=N.touches[0]||N.changedTouches[0];w&&a(w.clientX,w.clientY,"guest",t.id)}});return e.jsxs("div",{ref:x,className:`seat-guest ${C?"dragging":""} ${k?"has-group":""} ${d?"swap-target":""} ${m?"optimized":""} ${u?"":"dimmed"}`,title:b.join(`
`),onDoubleClick:T,onContextMenu:M,...v,...j,...y,children:[e.jsx("div",{className:"seat-guest-circle",style:k?{borderColor:k,borderWidth:"3px"}:void 0,children:e.jsx("span",{className:"initials",children:I})}),e.jsx("span",{className:"status-dot",style:{backgroundColor:R()}}),k&&e.jsx("span",{className:"group-dot",style:{backgroundColor:k}}),Y&&e.jsx("span",{className:"dietary-icon",children:Y}),f&&e.jsx("span",{className:"accessibility-icon",children:"â™¿"}),d&&e.jsx("span",{className:"swap-icon",children:"â‡„"})]})}function Qt({table:t,guests:n,isSelected:s,isSnapTarget:d,swapTargetGuestId:c,isNewlyAdded:a}){const{selectTable:h,removeTable:l,getViolationsForTable:o,toggleTableSelection:m,addTableToSelection:p,openContextMenu:u}=F(),j=o(t.id),y=j.length>0,x=j.some(H=>H.priority==="required"),{setNodeRef:C,isOver:I}=Lt({id:t.id,data:{type:"table"}}),{attributes:R,listeners:z,setNodeRef:Y,isDragging:f,transform:k}=Pe({id:t.id,data:{type:"table"}}),b=r.useRef(null),T=r.useRef({x:t.x,y:t.y}),M=r.useRef(!1);f&&k&&(b.current={x:k.x,y:k.y},M.current=!0);let v=null;f?v=k:M.current&&b.current?t.x!==T.current.x||t.y!==T.current.y?(b.current=null,T.current={x:t.x,y:t.y},M.current=!1,v=null):v=b.current:((t.x!==T.current.x||t.y!==T.current.y)&&(T.current={x:t.x,y:t.y}),v=null);const N=Kt(t.shape,t.capacity,t.width,t.height),w=n.length/t.capacity,E=n.length>t.capacity?"over":w>=1?"full":w>=.75?"nearly-full":"available",P=Math.max(t.width,t.height)+16,W=P/2-4,K=2*Math.PI*W,ee=K*(1-Math.min(w,1)),V=r.useMemo(()=>{const H={};let O=0;return n.forEach(U=>{U.dietaryRestrictions?.forEach(ae=>{const se=ae.toLowerCase();H[se]=(H[se]||0)+1}),U.accessibilityNeeds?.length&&(O+=1)}),{dietary:H,accessibility:O}},[n]),de=Object.keys(V.dietary).length>0||V.accessibility>0,oe=Object.values(V.dietary).reduce((H,O)=>H+O,0)+V.accessibility,te=()=>{const H=[];return Object.entries(V.dietary).forEach(([O,U])=>{const ae=Rt(O)||"";H.push(`${ae} ${O}: ${U}`)}),V.accessibility>0&&H.push(`${tt} Accessibility: ${V.accessibility}`),H.join(`
`)},Z=H=>{H.stopPropagation(),H.metaKey||H.ctrlKey?m(t.id):H.shiftKey?p(t.id):h(t.id)},B=H=>{H.stopPropagation(),confirm(`Delete ${t.name}? All guests will be unassigned.`)&&l(t.id)},q=H=>{H.preventDefault(),H.stopPropagation(),u(H.clientX,H.clientY,"table",t.id)},ne=Te({onLongPress:H=>{H.preventDefault();const O=H.touches[0]||H.changedTouches[0];O&&u(O.clientX,O.clientY,"table",t.id)}}),he=y?j.map(H=>`âš ï¸ ${H.description}`).join(`
`):"";return e.jsxs("div",{ref:H=>{C(H),Y(H)},className:`table-component ${t.shape} ${s?"selected":""} ${I?"drop-target":""} ${f?"dragging":""} ${d?"snap-target":""} capacity-${E} ${y?"has-violations":""} ${x?"has-required-violations":""} ${a?"newly-added":""}`,style:{left:t.x,top:t.y,width:t.width,height:t.height,transform:v?`translate(${v.x}px, ${v.y}px)`:void 0},onClick:Z,onContextMenu:q,...ne,...R,...z,children:[t.shape==="round"&&e.jsxs("svg",{className:"capacity-ring",width:P,height:P,style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none"},children:[e.jsx("circle",{cx:P/2,cy:P/2,r:W,fill:"none",stroke:"var(--color-border-light)",strokeWidth:"3"}),e.jsx("circle",{cx:P/2,cy:P/2,r:W,fill:"none",className:"capacity-progress",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:K,strokeDashoffset:ee,transform:`rotate(-90 ${P/2} ${P/2})`})]}),e.jsx("div",{className:"table-surface",children:e.jsxs("div",{className:"table-label",children:[e.jsx("span",{children:t.name}),e.jsxs("span",{className:`table-count ${E}`,children:[n.length,"/",t.capacity]})]})}),N.map((H,O)=>{const U=n.find(ae=>ae.seatIndex===O)||n[O];return e.jsx("div",{className:"seat",style:{left:H.x,top:H.y,transform:"translate(-50%, -50%)"},children:U&&e.jsx(Ft,{guest:U,seatPosition:H,tablePosition:{x:t.x,y:t.y},isSwapTarget:c===U.id})},O)}),y&&e.jsxs("div",{className:`violation-badge ${x?"required":"preferred"}`,title:he,children:["âš ï¸ ",j.length]}),de&&e.jsxs("div",{className:"table-dietary-summary",title:te(),children:[e.jsx("span",{className:"dietary-summary-icon",children:"ðŸ½ï¸"}),e.jsx("span",{className:"dietary-summary-count",children:oe})]}),I&&t.capacity>n.length&&e.jsxs("div",{className:"availability-indicator",children:[t.capacity-n.length," seat",t.capacity-n.length!==1?"s":""," available"]}),I&&t.capacity<=n.length&&e.jsx("div",{className:"availability-indicator full",children:"Table full"}),s&&e.jsx("button",{className:"table-delete",onClick:B,title:"Delete table",children:"Ã—"})]})}function Kt(t,n,s,d){const c=[];if(t==="round"){const a=s/2+20;for(let h=0;h<n;h++){const l=2*Math.PI*h/n-Math.PI/2;c.push({x:s/2+a*Math.cos(l),y:d/2+a*Math.sin(l)})}}else if(t==="oval"){const a=s/2+20,h=d/2+20;for(let l=0;l<n;l++){const o=2*Math.PI*l/n-Math.PI/2;c.push({x:s/2+a*Math.cos(o),y:d/2+h*Math.sin(o)})}}else if(t==="half-round"){const a=s/2+20;for(let h=0;h<n;h++){const l=Math.PI*(h/(n-1||1));c.push({x:s/2-a*Math.cos(l),y:d+a*Math.sin(l)*.5})}}else if(t==="serpentine"){if(n===0)return c;const a=d/4;for(let h=0;h<n;h++){const l=h/(n-1||1),o=l*s,m=d/2+a*Math.sin(l*2*Math.PI),p=a*2*Math.PI*Math.cos(l*2*Math.PI)/s,u=Math.atan2(p,1)+Math.PI/2;c.push({x:o+25*Math.cos(u),y:m+25*Math.sin(u)})}}else if(t==="rectangle"){const a=Math.ceil(n/2),h=s/(a+1);for(let l=0;l<a;l++)c.push({x:h*(l+1),y:-20});for(let l=0;l<n-a;l++)c.push({x:h*(l+1),y:d+20})}else{const a=Math.ceil(n/4),h=a*2,l=n-h;for(let o=0;o<a&&c.length<n;o++)c.push({x:s/(a+1)*(o+1),y:-20});for(let o=0;o<Math.ceil(l/2)&&c.length<n;o++)c.push({x:s+20,y:d/(Math.ceil(l/2)+1)*(o+1)});for(let o=0;o<a&&c.length<n;o++)c.push({x:s/(a+1)*(a-o),y:d+20});for(let o=0;o<Math.floor(l/2)&&c.length<n;o++)c.push({x:-20,y:d/(Math.floor(l/2)+1)*(o+1)})}return c}function Zt({guest:t,isSelected:n,isNearTable:s,isNewlyAdded:d}){const{toggleGuestSelection:c,addGuestToSelection:a,selectGuest:h,openContextMenu:l,setEditingGuest:o,visibleGroups:m}=F(),{attributes:p,listeners:u,setNodeRef:j,isDragging:y}=Pe({id:t.id,data:{type:"canvas-guest",guest:t}}),x=we(t),C=at(t.group),I=t.group??"",R=m==="all"||m.has(I),z=Dt(t.dietaryRestrictions),Y=z.length>0,f=t.accessibilityNeeds&&t.accessibilityNeeds.length>0,k=()=>{const M=[re(t)];return t.group&&M.push(`Group: ${t.group}`),t.dietaryRestrictions?.length&&M.push(`Diet: ${t.dietaryRestrictions.join(", ")}`),t.accessibilityNeeds?.length&&M.push(`Accessibility: ${t.accessibilityNeeds.join(", ")}`),M.join(`
`)},b=()=>{switch(t.rsvpStatus){case"confirmed":return"var(--color-success)";case"declined":return"var(--color-error)";default:return"var(--color-warning)"}},T=Te({onLongPress:M=>{M.preventDefault();const v=M.touches[0]||M.changedTouches[0];v&&l(v.clientX,v.clientY,"guest",t.id)}});return e.jsxs("div",{ref:j,className:`canvas-guest ${n?"selected":""} ${y?"dragging":""} ${s?"near-table":""} ${R?"":"dimmed"} ${d?"newly-added":""}`,style:{left:t.canvasX,top:t.canvasY},title:k(),onClick:M=>{M.stopPropagation(),M.metaKey||M.ctrlKey?c(t.id):M.shiftKey?a(t.id):h(t.id)},onDoubleClick:M=>{M.stopPropagation(),o(t.id)},onContextMenu:M=>{M.preventDefault(),M.stopPropagation(),l(M.clientX,M.clientY,"guest",t.id)},...T,...p,...u,children:[e.jsx("div",{className:"canvas-guest-circle",style:C?{boxShadow:`0 0 0 3px ${C}, var(--shadow-md)`}:void 0,children:e.jsx("span",{className:"initials",children:x})}),e.jsx("span",{className:"status-dot",style:{backgroundColor:b()}}),Y&&e.jsx("span",{className:"dietary-icon",children:z[0]}),f&&e.jsx("span",{className:"accessibility-icon",children:tt}),e.jsx("div",{className:"canvas-guest-label",children:re(t)})]})}function it({tableId:t,onClose:n}){const s=r.useRef(null),{event:d}=F(),c=r.useMemo(()=>d?.tables.find(u=>u.id===t),[d?.tables,t]),a=r.useMemo(()=>d&&c?Ht(d,c):"",[d,c]),h=r.useMemo(()=>d?.guests.filter(u=>u.tableId===t&&u.rsvpStatus==="confirmed").length??0,[d?.guests,t]),l=r.useCallback(async()=>{if(!c)return;const u=s.current?.querySelector("svg");if(u)try{await Gt(u,`${c.name}-qr-code`),ye("QR code downloaded","success")}catch{ye("Failed to download QR code","error")}},[c]),o=r.useCallback(async()=>{if(!a)return;await Et(a)?ye("URL copied to clipboard","success"):ye("Failed to copy URL","error")},[a]),m=r.useCallback(()=>{if(!c||!d)return;const u=window.open("","_blank");if(!u){ye("Unable to open print window","error");return}const j=s.current?.querySelector("svg");if(!j)return;const y=new XMLSerializer().serializeToString(j);u.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>QR Code - ${c.name}</title>
          <style>
            body {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              min-height: 100vh;
              margin: 0;
              padding: 2rem;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            }
            .qr-container {
              text-align: center;
            }
            .qr-code {
              width: 250px;
              height: 250px;
              margin-bottom: 1.5rem;
            }
            .table-name {
              font-size: 2rem;
              font-weight: bold;
              margin: 0 0 0.5rem;
            }
            .event-name {
              font-size: 1.25rem;
              color: #666;
              margin: 0 0 0.5rem;
            }
            .event-date {
              font-size: 1rem;
              color: #888;
              margin: 0 0 1.5rem;
            }
            .scan-text {
              font-size: 0.875rem;
              color: #888;
              font-style: italic;
            }
            @media print {
              body {
                padding: 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="qr-container">
            <div class="qr-code">${y}</div>
            <p class="table-name">${c.name}</p>
            <p class="event-name">${d.name}</p>
            ${d.date?`<p class="event-date">${d.date}</p>`:""}
            <p class="scan-text">Scan to view your tablemates</p>
          </div>
        </body>
      </html>
    `),u.document.close(),u.onload=()=>{u.print()}},[c,d]),p=r.useCallback(u=>{u.target===u.currentTarget&&n()},[n]);return!d||!c?null:e.jsx("div",{className:"modal-overlay qr-modal-overlay",onClick:p,children:e.jsxs("div",{className:"qr-modal",children:[e.jsxs("div",{className:"qr-modal-header",children:[e.jsxs("h2",{children:["QR Code for ",c.name]}),e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"qr-modal-content",children:[e.jsx("div",{className:"qr-code-container",ref:s,children:e.jsx($t,{value:a,size:200,level:"M",bgColor:"#ffffff",fgColor:"#000000"})}),e.jsxs("div",{className:"qr-table-info",children:[e.jsx("p",{className:"qr-table-name",children:c.name}),e.jsxs("p",{className:"qr-table-meta",children:[h," guest",h!==1?"s":""," assigned â€¢"," ",c.capacity," seats"]})]}),e.jsxs("div",{className:"qr-actions",children:[e.jsxs("button",{className:"qr-action-btn",onClick:l,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Download PNG"]}),e.jsxs("button",{className:"qr-action-btn",onClick:o,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"Copy URL"]}),e.jsxs("button",{className:"qr-action-btn",onClick:m,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),e.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),e.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),"Print"]})]}),e.jsx("p",{className:"qr-hint",children:"Guests can scan this QR code to view their tablemates"})]})]})})}function Jt(){const{event:t,canvas:n,updateTable:s,removeTable:d,selectTable:c,duplicateTable:a,rotateTable:h}=F(),l=Ae(),[o,m]=r.useState(!1),[p,u]=r.useState(0),[j,y]=r.useState(!1),x=n.selectedTableIds.length===1?t.tables.find(w=>w.id===n.selectedTableIds[0]):null,C=Bt(({movement:[,w],velocity:[,X],direction:[,E],last:P})=>{l&&(P?((w>100||X>.5&&E>0)&&c(null),u(0)):u(Math.max(0,w)))},{axis:"y",filterTaps:!0});if(!x)return null;const I=t.guests.filter(w=>w.tableId===x.id),R=t.tables.findIndex(w=>w.id===x.id),z=t.tables.length,Y=()=>{const w=(R-1+z)%z;c(t.tables[w].id)},f=()=>{const w=(R+1)%z;c(t.tables[w].id)},k=w=>{const X=Math.max(1,I.length),E=Math.max(X,Math.min(20,w));s(x.id,{capacity:E})},b=w=>{const V={round:{small:{width:80,height:80},medium:{width:120,height:120},large:{width:160,height:160}},rectangle:{small:{width:140,height:60},medium:{width:200,height:80},large:{width:260,height:100}},square:{small:{width:80,height:80},medium:{width:100,height:100},large:{width:140,height:140}},oval:{small:{width:140,height:90},medium:{width:180,height:120},large:{width:240,height:160}},"half-round":{small:{width:120,height:60},medium:{width:160,height:80},large:{width:200,height:100}},serpentine:{small:{width:200,height:80},medium:{width:300,height:100},large:{width:400,height:120}}};s(x.id,V[x.shape][w])},T=w=>{s(x.id,{shape:w})},M=()=>{confirm(`Delete ${x.name}?${I.length>0?` ${I.length} guest${I.length>1?"s":""} will be unassigned.`:""}`)&&d(x.id)},v=()=>{a(x.id)},N=()=>{h(x.id,45)};return e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"table-panel-backdrop",onClick:()=>c(null),"aria-hidden":"true"}),e.jsxs("div",{className:`table-properties-panel ${l?"mobile":""}`,style:l&&p>0?{transform:`translateY(${p}px)`}:void 0,children:[l&&e.jsx("div",{className:"panel-drag-handle",...C(),"aria-hidden":"true",children:e.jsx("div",{className:"drag-handle-bar"})}),e.jsxs("div",{className:"panel-header",children:[z>1&&e.jsx("button",{className:"nav-btn",onClick:Y,title:"Previous table","aria-label":"Previous table",children:"â€¹"}),e.jsxs("div",{className:"panel-title",children:[e.jsx("h3",{children:x.name}),z>1&&e.jsxs("span",{className:"table-counter",children:[R+1," of ",z]})]}),z>1&&e.jsx("button",{className:"nav-btn",onClick:f,title:"Next table","aria-label":"Next table",children:"â€º"}),e.jsx("button",{className:"close-btn",onClick:()=>c(null),title:"Close panel","aria-label":"Close panel",children:"Ã—"})]}),e.jsxs("div",{className:"quick-actions",children:[e.jsxs("button",{className:"quick-action-btn",onClick:v,title:"Duplicate table","aria-label":"Duplicate table",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),e.jsx("span",{children:"Duplicate"})]}),e.jsxs("button",{className:"quick-action-btn",onClick:N,title:"Rotate 45Â°","aria-label":"Rotate table 45 degrees",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M7.11 8.53L5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"})}),e.jsx("span",{children:"Rotate"})]}),e.jsxs("button",{className:"quick-action-btn",onClick:()=>y(!0),title:"Generate QR Code","aria-label":"Generate QR Code",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm13 2h-2v4h2v2h2v-2h2v-2h-2v-4h-2v2zm0-6h2v2h-2v-2zm-4 2h2v4h-2v-4zm-2 2h2v2h-2v-2z"})}),e.jsx("span",{children:"QR Code"})]}),e.jsxs("button",{className:"quick-action-btn delete",onClick:M,title:"Delete table","aria-label":"Delete table",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),e.jsx("span",{children:"Delete"})]})]}),e.jsxs("div",{className:"property-group",children:[e.jsx("label",{htmlFor:"table-name",children:"Name"}),e.jsx("input",{id:"table-name",type:"text",value:x.name,onChange:w=>s(x.id,{name:w.target.value})})]}),e.jsxs("div",{className:"property-group",children:[e.jsx("label",{children:"Shape"}),e.jsxs("div",{className:"shape-selector",children:[e.jsx("button",{className:x.shape==="round"?"active":"",onClick:()=>T("round"),title:"Round","aria-label":"Round table","aria-pressed":x.shape==="round",children:"â­•"}),e.jsx("button",{className:x.shape==="rectangle"?"active":"",onClick:()=>T("rectangle"),title:"Rectangle","aria-label":"Rectangle table","aria-pressed":x.shape==="rectangle",children:"â–­"}),e.jsx("button",{className:x.shape==="square"?"active":"",onClick:()=>T("square"),title:"Square","aria-label":"Square table","aria-pressed":x.shape==="square",children:"â¬œ"}),e.jsx("button",{className:x.shape==="oval"?"active":"",onClick:()=>T("oval"),title:"Oval","aria-label":"Oval table","aria-pressed":x.shape==="oval",children:"â¬­"}),e.jsx("button",{className:x.shape==="half-round"?"active":"",onClick:()=>T("half-round"),title:"Half-Round","aria-label":"Half-round table","aria-pressed":x.shape==="half-round",children:"â——"}),e.jsx("button",{className:x.shape==="serpentine"?"active":"",onClick:()=>T("serpentine"),title:"Serpentine (Buffet)","aria-label":"Serpentine table","aria-pressed":x.shape==="serpentine",children:"ã€°ï¸"})]})]}),e.jsxs("div",{className:"property-group",children:[e.jsx("label",{children:"Capacity"}),e.jsxs("div",{className:"capacity-control",children:[e.jsx("button",{onClick:()=>k(x.capacity-1),disabled:x.capacity<=I.length||x.capacity<=1,"aria-label":"Decrease capacity",children:"âˆ’"}),e.jsx("input",{type:"number",min:Math.max(1,I.length),max:20,value:x.capacity,onChange:w=>k(parseInt(w.target.value)||1),"aria-label":"Table capacity"}),e.jsx("button",{onClick:()=>k(x.capacity+1),disabled:x.capacity>=20,"aria-label":"Increase capacity",children:"+"})]}),e.jsxs("span",{className:"capacity-hint",children:[I.length," of ",x.capacity," seats filled"]})]}),l?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"advanced-toggle",onClick:()=>m(!o),"aria-expanded":o,children:["Advanced Settings",e.jsx("span",{className:`toggle-icon ${o?"open":""}`,children:"â€º"})]}),o&&e.jsxs("div",{className:"advanced-section",children:[e.jsxs("div",{className:"property-group",children:[e.jsx("label",{children:"Size Presets"}),e.jsxs("div",{className:"size-presets",children:[e.jsx("button",{onClick:()=>b("small"),children:"Small"}),e.jsx("button",{onClick:()=>b("medium"),children:"Medium"}),e.jsx("button",{onClick:()=>b("large"),children:"Large"})]})]}),e.jsxs("div",{className:"property-group",children:[e.jsx("label",{children:"Dimensions"}),e.jsxs("div",{className:"dimension-inputs",children:[e.jsxs("div",{children:[e.jsx("span",{children:"W"}),e.jsx("input",{type:"number",min:60,max:300,value:x.width,onChange:w=>s(x.id,{width:parseInt(w.target.value)||100}),"aria-label":"Table width"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"H"}),e.jsx("input",{type:"number",min:60,max:300,value:x.height,onChange:w=>s(x.id,{height:parseInt(w.target.value)||100}),"aria-label":"Table height"})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-group",children:[e.jsx("label",{children:"Size Presets"}),e.jsxs("div",{className:"size-presets",children:[e.jsx("button",{onClick:()=>b("small"),children:"Small"}),e.jsx("button",{onClick:()=>b("medium"),children:"Medium"}),e.jsx("button",{onClick:()=>b("large"),children:"Large"})]})]}),e.jsxs("div",{className:"property-group",children:[e.jsx("label",{children:"Dimensions"}),e.jsxs("div",{className:"dimension-inputs",children:[e.jsxs("div",{children:[e.jsx("span",{children:"W"}),e.jsx("input",{type:"number",min:60,max:300,value:x.width,onChange:w=>s(x.id,{width:parseInt(w.target.value)||100}),"aria-label":"Table width"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"H"}),e.jsx("input",{type:"number",min:60,max:300,value:x.height,onChange:w=>s(x.id,{height:parseInt(w.target.value)||100}),"aria-label":"Table height"})]})]})]}),e.jsx("div",{className:"panel-actions",children:e.jsx("button",{className:"delete-btn",onClick:M,children:"Delete Table"})})]}),I.length>0&&e.jsxs("div",{className:"assigned-guests",children:[e.jsxs("label",{children:["Assigned Guests (",I.length,")"]}),e.jsx("ul",{children:I.map(w=>e.jsx("li",{children:re(w)},w.id))})]})]}),j&&e.jsx(it,{tableId:x.id,onClose:()=>y(!1)})]})}function Le(t,n){const s=t.toLowerCase().trim(),d=n.toLowerCase().trim();if(!s)return 0;if(d===s)return 1;if(d.includes(s))return .9;const c=s.split(/\s+/),a=d.split(/\s+/);let h=0;for(const l of c)a.some(o=>o.startsWith(l))&&h++;return h>0?.5+h/c.length*.4:0}function es(){const{event:t,canvas:n,setPan:s,selectTable:d,selectGuest:c}=F(),[a,h]=r.useState(!1),[l,o]=r.useState(""),[m,p]=r.useState(0),[u,j]=r.useState(""),y=r.useRef(null),x=r.useCallback(f=>{p(f),j(l)},[l]),C=r.useCallback(()=>{h(!1),o(""),p(0),j("")},[]);r.useEffect(()=>{const f=k=>{(k.metaKey||k.ctrlKey)&&k.key==="f"&&(k.preventDefault(),h(!0)),k.key==="Escape"&&a&&C()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[a,C]),r.useEffect(()=>{a&&y.current&&y.current.focus()},[a]);const I=r.useMemo(()=>{if(!l.trim())return[];const f=t.guests.map(b=>{const T=Le(l,re(b)),M=b.group?Le(l,b.group)*.8:0,v=Math.max(T,M);let N=b.canvasX||0,w=b.canvasY||0;if(b.tableId){const E=t.tables.find(P=>P.id===b.tableId);E&&(N=E.x+E.width/2,w=E.y+E.height/2)}const X=b.tableId?t.tables.find(E=>E.id===b.tableId)?.name:"Unassigned";return{type:"guest",id:b.id,name:re(b),subtitle:X,x:N,y:w,score:v}}).filter(b=>b.score>.3).sort((b,T)=>T.score-b.score).slice(0,5),k=t.tables.map(b=>{const T=Le(l,b.name),M=t.guests.filter(v=>v.tableId===b.id).length;return{type:"table",id:b.id,name:b.name,subtitle:`${M}/${b.capacity} guests`,x:b.x+b.width/2,y:b.y+b.height/2,score:T}}).filter(b=>b.score>.3).sort((b,T)=>T.score-b.score).slice(0,5);return[...f,...k].sort((b,T)=>T.score-b.score).slice(0,10)},[l,t.guests,t.tables]),R=l!==u?0:m,z=r.useCallback(f=>{const k=window.innerWidth,b=window.innerHeight,T=k/2-f.x*n.zoom,M=b/2-f.y*n.zoom;s(T,M),f.type==="table"?d(f.id):c(f.id),C()},[n.zoom,s,d,c,C]),Y=f=>{f.key==="ArrowDown"?(f.preventDefault(),x(Math.min(R+1,I.length-1))):f.key==="ArrowUp"?(f.preventDefault(),x(Math.max(R-1,0))):f.key==="Enter"&&I[R]&&(f.preventDefault(),z(I[R]))};return a?e.jsx("div",{className:"canvas-search-overlay",onClick:C,children:e.jsxs("div",{className:"canvas-search-modal",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("span",{className:"search-icon",children:"ðŸ”"}),e.jsx("input",{ref:y,type:"text",placeholder:"Search guests, tables, or groups...",value:l,onChange:f=>o(f.target.value),onKeyDown:Y}),e.jsx("kbd",{className:"shortcut-hint",children:"ESC"})]}),I.length>0&&e.jsx("ul",{className:"search-results",children:I.map((f,k)=>e.jsxs("li",{className:`search-result ${k===R?"selected":""}`,onClick:()=>z(f),onMouseEnter:()=>x(k),children:[e.jsx("span",{className:"result-icon",children:f.type==="guest"?"ðŸ‘¤":"ðŸª‘"}),e.jsxs("div",{className:"result-info",children:[e.jsx("span",{className:"result-name",children:f.name}),f.subtitle&&e.jsx("span",{className:"result-subtitle",children:f.subtitle})]}),e.jsx("span",{className:"result-type",children:f.type})]},`${f.type}-${f.id}`))}),l&&I.length===0&&e.jsxs("div",{className:"search-empty",children:['No results found for "',l,'"']}),e.jsxs("div",{className:"search-footer",children:[e.jsxs("span",{children:[e.jsx("kbd",{children:"â†‘"})," ",e.jsx("kbd",{children:"â†“"})," Navigate"]}),e.jsxs("span",{children:[e.jsx("kbd",{children:"Enter"})," Go to"]}),e.jsxs("span",{children:[e.jsx("kbd",{children:"Esc"})," Close"]})]})]})}):null}const Ce=180,Me=120,Se=20;function ts(){const{event:t,canvas:n,setPan:s}=F(),[d,c]=r.useState(!1),[a,h]=r.useState(null),l=r.useRef(null),o=r.useMemo(()=>{const f=t.tables,k=t.venueElements||[];if(f.length===0&&k.length===0)return{minX:0,minY:0,maxX:1e3,maxY:800};let b=1/0,T=1/0,M=-1/0,v=-1/0;for(const N of f)b=Math.min(b,N.x),T=Math.min(T,N.y),M=Math.max(M,N.x+N.width),v=Math.max(v,N.y+N.height);for(const N of k)b=Math.min(b,N.x),T=Math.min(T,N.y),M=Math.max(M,N.x+N.width),v=Math.max(v,N.y+N.height);return{minX:b-Se,minY:T-Se,maxX:M+Se,maxY:v+Se}},[t.tables,t.venueElements]),m=o.maxX-o.minX,p=o.maxY-o.minY,u=Math.min(Ce/m,Me/p,1),j=window.innerWidth-280,y=window.innerHeight-120,x={x:(-n.panX/n.zoom-o.minX)*u,y:(-n.panY/n.zoom-o.minY)*u,width:j/n.zoom*u,height:y/n.zoom*u},C=r.useCallback(f=>{if(!l.current)return;const k=l.current.getBoundingClientRect(),b=f.clientX-k.left,T=f.clientY-k.top,M=b/u+o.minX,v=T/u+o.minY,N=j/2-M*n.zoom,w=y/2-v*n.zoom;s(N,w)},[u,o,n.zoom,j,y,s]),I=r.useCallback(f=>{f.stopPropagation(),c(!0)},[]),R=r.useCallback(f=>{if(!d||!l.current)return;const k=l.current.getBoundingClientRect(),b=f.clientX-k.left,T=f.clientY-k.top,M=b/u+o.minX,v=T/u+o.minY,N=j/2-M*n.zoom,w=y/2-v*n.zoom;s(N,w)},[d,u,o,n.zoom,j,y,s]),z=r.useCallback(()=>{c(!1)},[]);if(t.tables.length===0&&(!t.venueElements||t.venueElements.length===0))return null;const Y=a?t.tables.find(f=>f.id===a):null;return e.jsxs("div",{className:"canvas-minimap",children:[e.jsxs("svg",{ref:l,width:Ce,height:Me,onClick:C,onMouseMove:R,onMouseUp:z,onMouseLeave:z,children:[e.jsx("rect",{width:Ce,height:Me,fill:"var(--color-bg-hover)",rx:4}),(t.venueElements||[]).map(f=>e.jsx("rect",{x:(f.x-o.minX)*u,y:(f.y-o.minY)*u,width:f.width*u,height:f.height*u,fill:"var(--color-text-secondary)",opacity:.3,rx:2},f.id)),t.tables.map(f=>{const b=t.guests.filter(M=>M.tableId===f.id).length>=f.capacity,T=n.selectedTableIds.includes(f.id);return e.jsx("rect",{x:(f.x-o.minX)*u,y:(f.y-o.minY)*u,width:f.width*u,height:f.height*u,rx:f.shape==="round"||f.shape==="oval"?f.width*u/2:2,fill:T?"var(--color-primary)":b?"var(--color-success)":"var(--color-secondary)",stroke:T?"var(--color-primary)":"none",strokeWidth:2,opacity:T?1:.8,className:"minimap-table",onMouseEnter:()=>h(f.id),onMouseLeave:()=>h(null)},f.id)}),e.jsx("rect",{x:Math.max(0,x.x),y:Math.max(0,x.y),width:Math.min(x.width,Ce-x.x),height:Math.min(x.height,Me-x.y),fill:"none",stroke:"var(--color-text)",strokeWidth:2,strokeDasharray:"4 2",rx:2,className:"viewport-indicator",onMouseDown:I,style:{cursor:d?"grabbing":"grab"}})]}),e.jsxs("div",{className:"minimap-label",children:[e.jsxs("span",{children:[t.tables.length," tables"]}),e.jsxs("span",{children:[Math.round(n.zoom*100),"%"]})]}),Y&&e.jsxs("div",{className:"minimap-tooltip",children:[e.jsx("strong",{children:Y.name}),e.jsxs("span",{children:[t.guests.filter(f=>f.tableId===Y.id).length,"/",Y.capacity," guests"]})]})]})}function ss(){const{event:t,canvas:n,batchAssignGuests:s,batchRemoveGuests:d,batchRemoveTables:c,clearAllSelection:a,pushHistory:h}=F(),[l,o]=r.useState(!1),m=n.selectedGuestIds.length,p=n.selectedTableIds.length;if(m+p===0)return null;const j=C=>{h("Batch assign guests"),s(n.selectedGuestIds,C),o(!1)},y=()=>{let C;m>0&&p>0?C=`Delete ${m} guest${m>1?"s":""} and ${p} table${p>1?"s":""}? Other guests seated at deleted tables will be unassigned.`:m>0?C=`Delete ${m} guest${m>1?"s":""}?`:C=`Delete ${p} table${p>1?"s":""}? Seated guests will be unassigned.`,confirm(C)&&(h("Batch delete"),m>0&&d(n.selectedGuestIds),p>0&&c(n.selectedTableIds))},x=()=>m>0&&p>0?`${m} guest${m>1?"s":""}, ${p} table${p>1?"s":""}`:m>0?`${m} guest${m>1?"s":""} selected`:`${p} table${p>1?"s":""} selected`;return e.jsxs("div",{className:"selection-toolbar",children:[e.jsx("span",{className:"selection-count",children:x()}),m>0&&e.jsxs("div",{className:"selection-toolbar-dropdown",children:[e.jsxs("button",{className:"selection-toolbar-button",onClick:()=>o(!l),children:["Assign to Table",e.jsx("span",{className:"dropdown-arrow",children:"â–¾"})]}),l&&e.jsxs("div",{className:"selection-dropdown-menu",children:[t.tables.map(C=>{const I=t.guests.filter(Y=>Y.tableId===C.id).length,R=C.capacity-I,z=R>=m;return e.jsxs("button",{onClick:()=>j(C.id),className:`dropdown-item ${z?"":"warning"}`,title:z?void 0:`Only ${R} seats available`,children:[e.jsx("span",{children:C.name}),e.jsxs("span",{className:"seat-count",children:[I,"/",C.capacity]})]},C.id)}),t.tables.length===0&&e.jsx("div",{className:"dropdown-empty",children:"No tables available"})]})]}),e.jsx("button",{className:"selection-toolbar-button danger",onClick:y,children:"Delete"}),e.jsx("button",{className:"selection-toolbar-button clear",onClick:a,children:"Ã—"})]})}function ns({x:t,y:n,items:s,onClose:d}){const c=r.useRef(null);return r.useEffect(()=>{const a=o=>{c.current&&!c.current.contains(o.target)&&d()},h=o=>{o.key==="Escape"&&d()},l=setTimeout(()=>{document.addEventListener("mousedown",a),document.addEventListener("keydown",h)},0);return()=>{clearTimeout(l),document.removeEventListener("mousedown",a),document.removeEventListener("keydown",h)}},[d]),r.useEffect(()=>{if(!c.current)return;const a=c.current,h=a.getBoundingClientRect(),l=window.innerWidth,o=window.innerHeight;let m=t,p=n;t+h.width>l-10&&(m=l-h.width-10),n+h.height>o-10&&(p=o-h.height-10),a.style.left=`${m}px`,a.style.top=`${p}px`},[t,n]),e.jsx("div",{ref:c,className:"context-menu",style:{left:t,top:n},children:s.map((a,h)=>a.divider?e.jsx("div",{className:"context-menu-divider"},h):e.jsxs("button",{className:`context-menu-item ${a.disabled?"disabled":""} ${a.danger?"danger":""}`,onClick:()=>{a.disabled||(a.onClick(),d())},disabled:a.disabled,children:[a.icon&&e.jsx("span",{className:"context-menu-icon",children:a.icon}),e.jsx("span",{className:"context-menu-label",children:a.label})]},h))})}function as(){const{canvas:t,pushHistory:n,alignTables:s,distributeTables:d,autoArrangeTables:c}=F(),a=t.selectedTableIds.length;if(a<2)return null;const h=m=>{n(`Align tables ${m}`),s(t.selectedTableIds,m)},l=m=>{n(`Distribute tables ${m}`),d(t.selectedTableIds,m)},o=()=>{n("Auto-arrange tables"),c(t.selectedTableIds)};return e.jsxs("div",{className:"layout-toolbar",children:[e.jsxs("div",{className:"layout-toolbar-section",children:[e.jsx("span",{className:"section-label",children:"Align"}),e.jsxs("div",{className:"layout-buttons",children:[e.jsx("button",{onClick:()=>h("left"),title:"Align Left",className:"layout-btn",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M4 22H2V2h2v20zM22 7H6v3h16V7zm-6 7H6v3h10v-3z"})})}),e.jsx("button",{onClick:()=>h("center"),title:"Align Center (Horizontal)",className:"layout-btn",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M8 19h3v4h2v-4h3l-4-4-4 4zm8-14h-3V1h-2v4H8l4 4 4-4zM4 11v2h16v-2H4z"})})}),e.jsx("button",{onClick:()=>h("right"),title:"Align Right",className:"layout-btn",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M20 2h2v20h-2V2zM2 10h16V7H2v3zm6 7h10v-3H8v3z"})})}),e.jsx("span",{className:"separator"}),e.jsx("button",{onClick:()=>h("top"),title:"Align Top",className:"layout-btn",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M22 2v2H2V2h20zM7 22h3V6H7v16zm7 0h3V6h-3v16z"})})}),e.jsx("button",{onClick:()=>h("middle"),title:"Align Middle (Vertical)",className:"layout-btn",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M19 8l-4 4h3v4h-3l4 4 4-4h-3v-4h3l-4-4zM1 8l4 4H2v4h3l-4 4-4-4h3v-4H-3L1 8zm10 3v2h2v-2h-2z"})})}),e.jsx("button",{onClick:()=>h("bottom"),title:"Align Bottom",className:"layout-btn",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M22 22v-2H2v2h20zM7 2h3v16H7V2zm7 0h3v16h-3V2z"})})})]})]}),e.jsxs("div",{className:"layout-toolbar-section",children:[e.jsx("span",{className:"section-label",children:"Distribute"}),e.jsxs("div",{className:"layout-buttons",children:[e.jsx("button",{onClick:()=>l("horizontal"),title:"Distribute Horizontally",className:"layout-btn",disabled:a<3,children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M4 5v14h2V5H4zm14 0v14h2V5h-2zM9 5h2v14H9V5zm4 0h2v14h-2V5z"})})}),e.jsx("button",{onClick:()=>l("vertical"),title:"Distribute Vertically",className:"layout-btn",disabled:a<3,children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M5 4h14v2H5V4zm0 14h14v2H5v-2zM5 9h14v2H5V9zm0 4h14v2H5v-2z"})})})]})]}),e.jsxs("div",{className:"layout-toolbar-section",children:[e.jsx("span",{className:"section-label",children:"Arrange"}),e.jsx("div",{className:"layout-buttons",children:e.jsxs("button",{onClick:o,title:"Auto-Arrange in Grid",className:"layout-btn auto-arrange",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M3 3h8v8H3V3zm0 10h8v8H3v-8zm10-10h8v8h-8V3zm0 10h8v8h-8v-8z"})}),e.jsx("span",{children:"Grid"})]})})]})]})}function is(){const{canvasPrefs:t,toggleGrid:n,toggleSnapToGrid:s,toggleAlignmentGuides:d,togglePanMode:c,setGridSize:a}=F(),h=Ae(),[l,o]=r.useState(!1),[m,p]=r.useState(!1),u=r.useRef(null),j=r.useRef(null);return r.useEffect(()=>{const y=x=>{u.current&&!u.current.contains(x.target)&&o(!1),j.current&&!j.current.contains(x.target)&&p(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]),h?e.jsxs("div",{className:"grid-controls-mobile",ref:j,children:[e.jsx("button",{className:`grid-control-btn mobile-menu-trigger ${m?"active":""}`,onClick:()=>p(!m),"aria-label":"Grid options","aria-expanded":m,children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M20 3H4c-.55 0-1 .45-1 1v16c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM9 19H5v-4h4v4zm0-6H5V9h4v4zm0-6H5V5h4v2zm6 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2zm4 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2z"})})}),m&&e.jsxs("div",{className:"mobile-grid-menu",children:[e.jsx("div",{className:"mobile-menu-header",children:"Grid Options"}),e.jsxs("button",{className:`mobile-menu-item ${t.showGrid?"active":""}`,onClick:()=>{n()},children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M20 3H4c-.55 0-1 .45-1 1v16c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM9 19H5v-4h4v4zm0-6H5V9h4v4zm0-6H5V5h4v2zm6 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2zm4 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2z"})}),e.jsx("span",{children:"Show Grid"}),t.showGrid&&e.jsx("span",{className:"checkmark",children:"âœ“"})]}),e.jsxs("button",{className:`mobile-menu-item ${t.snapToGrid?"active":""}`,onClick:()=>{s()},children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M3 3v8h8V3H3zm6 6H5V5h4v4zm-6 4v8h8v-8H3zm6 6H5v-4h4v4zm4-16v8h8V3h-8zm6 6h-4V5h4v4zm-6 4v8h8v-8h-8zm6 6h-4v-4h4v4z"})}),e.jsx("span",{children:"Snap to Grid"}),t.snapToGrid&&e.jsx("span",{className:"checkmark",children:"âœ“"})]}),e.jsxs("button",{className:`mobile-menu-item ${t.showAlignmentGuides?"active":""}`,onClick:()=>{d()},children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M11 2v4h2V2h-2zm0 16v4h2v-4h-2zM2 11v2h4v-2H2zm16 0v2h4v-2h-4zm-7 1a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"})}),e.jsx("span",{children:"Alignment Guides"}),t.showAlignmentGuides&&e.jsx("span",{className:"checkmark",children:"âœ“"})]}),e.jsx("div",{className:"mobile-menu-divider"}),e.jsxs("button",{className:`mobile-menu-item ${t.panMode?"active":""}`,onClick:()=>{c()},children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"})}),e.jsx("span",{children:"Pan Mode (1-finger)"}),t.panMode&&e.jsx("span",{className:"checkmark",children:"âœ“"})]}),e.jsx("div",{className:"mobile-menu-divider"}),e.jsx("div",{className:"mobile-menu-label",children:"Grid Size"}),e.jsx("div",{className:"mobile-grid-sizes",children:[20,40,80].map(y=>e.jsxs("button",{onClick:()=>{a(y)},className:`mobile-size-option ${t.gridSize===y?"selected":""}`,children:[y,"px"]},y))})]})]}):e.jsxs("div",{className:"grid-controls",children:[e.jsx("span",{className:"grid-controls-label",children:"Grid"}),e.jsx("button",{className:`grid-control-btn has-tooltip ${t.showGrid?"active":""}`,onClick:n,"aria-label":t.showGrid?"Hide grid":"Show grid","aria-pressed":t.showGrid,"data-tooltip":t.showGrid?"Hide Grid":"Show Grid",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M20 3H4c-.55 0-1 .45-1 1v16c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM9 19H5v-4h4v4zm0-6H5V9h4v4zm0-6H5V5h4v2zm6 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2zm4 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2z"})})}),e.jsx("button",{className:`grid-control-btn has-tooltip ${t.snapToGrid?"active":""}`,onClick:s,"aria-label":t.snapToGrid?"Disable snap to grid":"Enable snap to grid","aria-pressed":t.snapToGrid,"data-tooltip":t.snapToGrid?"Snap: On":"Snap: Off",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M3 3v8h8V3H3zm6 6H5V5h4v4zm-6 4v8h8v-8H3zm6 6H5v-4h4v4zm4-16v8h8V3h-8zm6 6h-4V5h4v4zm-6 4v8h8v-8h-8zm6 6h-4v-4h4v4z"})})}),e.jsx("button",{className:`grid-control-btn has-tooltip ${t.showAlignmentGuides?"active":""}`,onClick:d,"aria-label":t.showAlignmentGuides?"Disable alignment guides":"Enable alignment guides","aria-pressed":t.showAlignmentGuides,"data-tooltip":t.showAlignmentGuides?"Guides: On":"Guides: Off",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M11 2v4h2V2h-2zm0 16v4h2v-4h-2zM2 11v2h4v-2H2zm16 0v2h4v-2h-4zm-7 1a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"})})}),e.jsxs("div",{className:"grid-size-dropdown",ref:u,children:[e.jsx("button",{className:"grid-control-btn grid-size-btn has-tooltip",onClick:()=>o(!l),"aria-label":`Grid size: ${t.gridSize}px`,"aria-expanded":l,"aria-haspopup":"listbox","data-tooltip":"Grid Size",children:e.jsx("span",{className:"grid-size-value",children:t.gridSize})}),l&&e.jsx("div",{className:"grid-size-menu",role:"listbox","aria-label":"Grid size options",children:[20,40,80].map(y=>e.jsxs("button",{onClick:()=>{a(y),o(!1)},className:`grid-size-option ${t.gridSize===y?"selected":""}`,role:"option","aria-selected":t.gridSize===y,children:[y,"px"]},y))})]})]})}function ls({onAddGuest:t,isHidden:n=!1}){const{event:s,addTable:d}=F(),[c,a]=r.useState(!1),h=r.useRef(null);r.useEffect(()=>{const p=u=>{h.current&&!h.current.contains(u.target)&&a(!1)};if(c)return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[c]),r.useEffect(()=>{const p=u=>{u.key==="Escape"&&a(!1)};if(c)return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[c]);const l=p=>{const u=s.tables.length+1,j=Math.max(100,window.innerWidth/2-50+u*30%100),y=Math.max(100,window.innerHeight/2-50+u*20%80);d(p,j,y),a(!1)},o=()=>{t(),a(!1)},m=e.jsxs("div",{className:`mobile-fab-container ${n?"hidden":""} ${c?"expanded":""}`,ref:h,children:[c&&e.jsx("div",{className:"fab-backdrop",onClick:()=>a(!1)}),e.jsxs("div",{className:`fab-actions ${c?"visible":""}`,children:[e.jsxs("button",{className:"fab-action",onClick:o,"aria-label":"Add Guest",children:[e.jsx("span",{className:"fab-action-icon",children:"ðŸ‘¤"}),e.jsx("span",{className:"fab-action-label",children:"Guest"})]}),e.jsxs("button",{className:"fab-action",onClick:()=>l("round"),"aria-label":"Add Round Table",children:[e.jsx("span",{className:"fab-action-icon",children:"â­•"}),e.jsx("span",{className:"fab-action-label",children:"Round"})]}),e.jsxs("button",{className:"fab-action",onClick:()=>l("rectangle"),"aria-label":"Add Rectangle Table",children:[e.jsx("span",{className:"fab-action-icon",children:"â–­"}),e.jsx("span",{className:"fab-action-label",children:"Rectangle"})]})]}),e.jsx("button",{className:`mobile-fab ${c?"active":""}`,onClick:()=>a(!c),"aria-label":c?"Close menu":"Add items","aria-expanded":c,children:e.jsx("svg",{viewBox:"0 0 24 24",width:"28",height:"28",className:"fab-icon",children:e.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})]});return nt.createPortal(m,document.body)}const ce={SMALL:.25,MEDIUM:.5,LARGE:.9},Q={VELOCITY_THRESHOLD:.5,DISTANCE_THRESHOLD:80,RUBBER_BAND_FACTOR:.3,DISMISS_THRESHOLD:50};function Ve(t,n,s=Q.RUBBER_BAND_FACTOR){if(t>=0&&t<=n)return t;const d=t>n?t-n:t,c=d*s*(1-Math.min(Math.abs(d)/500,.8));return t>n?n+c:c}function os(t,n,s,d=[ce.SMALL,ce.MEDIUM,ce.LARGE]){const c=1-t/s,a=Math.min(...d);if(c<a-Q.DISMISS_THRESHOLD/s)return-1;if(Math.abs(n)>Q.VELOCITY_THRESHOLD){const h=n>0?-1:1,l=[...d].sort((p,u)=>p-u);let o=l.findIndex(p=>p>=c);o===-1&&(o=l.length-1);const m=Math.max(0,Math.min(l.length-1,o+h));return l[m]}return d.reduce((h,l)=>Math.abs(l-c)<Math.abs(h-c)?l:h)}function cs(t){return t<=ce.SMALL+.05?"small":t<=ce.MEDIUM+.1?"medium":"large"}function rs(t){return t?t.scrollTop<=0:!0}const ds=30,hs=80;function us({isOpen:t,onOpen:n,onClose:s}){const{event:d,selectGuest:c,setEditingGuest:a,canvas:h,panToPosition:l}=F(),[o,m]=r.useState(""),[p,u]=r.useState("all"),[j,y]=r.useState(0),[x,C]=r.useState(!1),I=r.useRef(null),R=r.useRef(null),z=d.guests.filter(v=>re(v).toLowerCase().includes(o.toLowerCase())?p==="unassigned"?!v.tableId:p==="assigned"?!!v.tableId:!0:!1),Y=z.filter(v=>!v.tableId),f=z.filter(v=>v.tableId);fe({onDrag:({movement:[v],velocity:[N],direction:[w],active:X,xy:[E]})=>{if(t)return;const P=window.innerWidth;if(E>=P-ds&&!X){const K=Q.VELOCITY_THRESHOLD;w<0&&(N>K||Math.abs(v)>hs)&&n()}}},{target:typeof window<"u"?window:void 0,drag:{pointer:{touch:!0},filterTaps:!0,threshold:10,axis:"x"},enabled:!t}),fe({onDrag:({movement:[v],velocity:[N],direction:[w],active:X})=>{if(t)if(X)if(C(!0),v<0){const E=Ve(v,0,Q.RUBBER_BAND_FACTOR);y(E)}else y(v);else{C(!1),y(0);const E=Q.VELOCITY_THRESHOLD,P=Q.DISTANCE_THRESHOLD;w>0&&(N>E||v>P)&&s()}}},{target:R,drag:{pointer:{touch:!0},filterTaps:!0,threshold:5,axis:"x"},enabled:t});const k=v=>v.tableId?d.tables.find(w=>w.id===v.tableId)?.name||"Table":null,b=v=>{if(c(v.id),v.tableId){const N=d.tables.find(w=>w.id===v.tableId);if(N){const w=window.innerWidth,X=window.innerHeight;l(N.x,N.y,w,X)}}else if(v.canvasX!==void 0&&v.canvasY!==void 0){const N=window.innerWidth,w=window.innerHeight;l(v.canvasX,v.canvasY,N,w)}s()},T=(v,N)=>{N.stopPropagation(),a(v.id),s()},M=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`mobile-guest-panel-backdrop ${t?"visible":""}`,onClick:s}),e.jsxs("div",{ref:I,className:`mobile-guest-panel ${t?"open":""} ${x?"dragging":""}`,style:{transform:x&&j>0?`translateX(${j}px)`:void 0},children:[e.jsx("div",{ref:R,className:"panel-handle",children:e.jsx("div",{className:"handle-bar"})}),e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Guests"}),e.jsx("span",{className:"guest-count-badge",children:d.guests.length}),e.jsx("button",{className:"panel-close",onClick:s,children:e.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:e.jsx("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),e.jsxs("div",{className:"panel-search",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",className:"search-icon",children:e.jsx("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),e.jsx("input",{type:"text",placeholder:"Search guests...",value:o,onChange:v=>m(v.target.value)}),o&&e.jsx("button",{className:"search-clear",onClick:()=>m(""),children:"Ã—"})]}),e.jsxs("div",{className:"panel-filters",children:[e.jsxs("button",{className:`filter-btn ${p==="all"?"active":""}`,onClick:()=>u("all"),children:["All (",d.guests.length,")"]}),e.jsxs("button",{className:`filter-btn ${p==="unassigned"?"active":""}`,onClick:()=>u("unassigned"),children:["Unassigned (",d.guests.filter(v=>!v.tableId).length,")"]}),e.jsxs("button",{className:`filter-btn ${p==="assigned"?"active":""}`,onClick:()=>u("assigned"),children:["Seated (",d.guests.filter(v=>v.tableId).length,")"]})]}),e.jsx("div",{className:"panel-guest-list",children:z.length===0?e.jsx("div",{className:"panel-empty",children:o?`No guests match "${o}"`:"No guests yet"}):e.jsxs(e.Fragment,{children:[p!=="assigned"&&Y.length>0&&e.jsxs("div",{className:"guest-section",children:[p==="all"&&e.jsx("div",{className:"section-label",children:"Unassigned"}),Y.map(v=>e.jsxs("div",{className:`panel-guest-item ${h.selectedGuestIds.includes(v.id)?"selected":""}`,onClick:()=>b(v),children:[e.jsx("div",{className:"guest-avatar",style:{backgroundColor:v.group?`var(--group-${v.group})`:"var(--color-text-secondary)"},children:we(v)}),e.jsxs("div",{className:"guest-info",children:[e.jsx("span",{className:"guest-name",children:re(v)}),v.group&&e.jsx("span",{className:"guest-group",children:v.group})]}),e.jsx("button",{className:"guest-edit-btn",onClick:N=>T(v,N),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})})]},v.id))]}),p!=="unassigned"&&f.length>0&&e.jsxs("div",{className:"guest-section",children:[p==="all"&&e.jsx("div",{className:"section-label",children:"Seated"}),f.map(v=>e.jsxs("div",{className:`panel-guest-item ${h.selectedGuestIds.includes(v.id)?"selected":""}`,onClick:()=>b(v),children:[e.jsx("div",{className:"guest-avatar",style:{backgroundColor:v.group?`var(--group-${v.group})`:"var(--color-text-secondary)"},children:we(v)}),e.jsxs("div",{className:"guest-info",children:[e.jsx("span",{className:"guest-name",children:re(v)}),e.jsx("span",{className:"guest-table",children:k(v)})]}),e.jsx("button",{className:"guest-edit-btn",onClick:N=>T(v,N),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{fill:"currentColor",d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})})]},v.id))]})]})})]})]});return nt.createPortal(M,document.body)}function ms({isVisible:t,onClose:n,onOpenSettings:s}){const d=Xe(),{event:c,setEventName:a}=F(),[h,l]=r.useState(!1),[o,m]=r.useState(0),[p,u]=r.useState(!1),j=r.useRef(null),y=r.useRef(null);r.useEffect(()=>{h&&j.current&&(j.current.focus(),j.current.select())},[h]);const x=()=>{n(),d("/events")},C=()=>{l(!0)},I=()=>{l(!1)},R=z=>{(z.key==="Enter"||z.key==="Escape")&&l(!1)};return fe({onDrag:({movement:[,z],velocity:[,Y],direction:[,f],active:k})=>{if(t)if(k)if(u(!0),z>0){const b=Ve(z,0,Q.RUBBER_BAND_FACTOR);m(b)}else m(z);else{u(!1),m(0);const b=Q.VELOCITY_THRESHOLD,T=Q.DISTANCE_THRESHOLD;f<0&&(Y>b||Math.abs(z)>T)&&n()}}},{target:y,drag:{pointer:{touch:!0},filterTaps:!0,threshold:5,axis:"y"},enabled:t}),e.jsxs("div",{ref:y,className:`transient-top-bar ${t?"visible":""} ${p?"dragging":""}`,style:{"--drag-offset":p?`${o}px`:"0px"},children:[e.jsx("button",{className:"back-btn",onClick:x,"aria-label":"Back to events",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})})}),h?e.jsx("input",{ref:j,type:"text",value:c.name,onChange:z=>a(z.target.value),onBlur:I,onKeyDown:R,className:"event-name-input"}):e.jsx("button",{className:"event-name",onClick:C,"aria-label":"Edit event name",children:c.name||"Untitled Event"}),e.jsx("button",{className:"menu-btn",onClick:s,"aria-label":"Open settings",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})})]})}function vs({isVisible:t,onClose:n,showRelationships:s,onToggleRelationships:d,onShowImport:c,initialDetent:a="medium",onDetentChange:h}){const l=Xe(),{event:o,canvas:m,canvasPrefs:p,setZoom:u,recenterCanvas:j,toggleGrid:y,toggleSnapToGrid:x,toggleAlignmentGuides:C,theme:I,cycleTheme:R,activeView:z,setActiveView:Y}=F(),{onShowHelp:f,onStartTour:k}=st(),[b,T]=r.useState(a),[M,v]=r.useState(0),[N,w]=r.useState(!1),[X,E]=r.useState(!1),P=r.useRef(null),W=r.useRef(null),K=r.useRef(null),ee=r.useRef(t);r.useEffect(()=>{const q=ee.current;if(ee.current=t,t&&!q){const ne=setTimeout(()=>E(!0),0),he=setTimeout(()=>E(!1),350);return()=>{clearTimeout(ne),clearTimeout(he)}}if(!t&&q){const ne=setTimeout(()=>{T(a),v(0),w(!1)},0);return()=>clearTimeout(ne)}},[t,a]);const V=r.useCallback(()=>{h?.("closed"),n()},[n,h]);if(fe({onDrag:({movement:[,q],velocity:[,ne],direction:[,he],active:H,cancel:O})=>{if(!t){O?.();return}if(b==="large"&&!rs(W.current)&&q<0){O?.();return}const U=window.innerHeight;if(H){w(!0);const ae=0,se=U*.3,ue=Ve(q,se,Q.RUBBER_BAND_FACTOR);(q>0||b!=="large")&&v(Math.max(ae,ue))}else{w(!1);const se=U*ce[b.toUpperCase()]-M,ue=U-se;if(ne>Q.VELOCITY_THRESHOLD&&he>0&&q>50||se<U*.15){v(0),V();return}const Ne=[ce.SMALL,ce.MEDIUM,ce.LARGE],me=os(ue,ne,U,Ne);if(me===-1)v(0),V();else{const xe=cs(me);T(xe),h?.(xe)}v(0)}}},{target:P,drag:{pointer:{touch:!0},axis:"y",filterTaps:!0,threshold:5}}),!t)return null;const de=q=>{Y(q),l(`/events/${o.id}/${q}`),V()},oe=()=>{switch(I){case"light":return"â˜€ï¸";case"dark":return"ðŸŒ™";default:return"âš™ï¸"}},te=()=>{switch(I){case"light":return"Light";case"dark":return"Dark";default:return"System"}},Z=`${ce[b.toUpperCase()]*100}vh`,B=["bottom-control-sheet",N&&"bottom-control-sheet--dragging",X&&"bottom-control-sheet--entering"].filter(Boolean).join(" ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sheet-backdrop",onClick:V}),e.jsxs("div",{ref:K,className:B,"data-detent":b,style:{"--sheet-height":Z,transform:N?`translateY(${M}px)`:void 0},children:[e.jsx("div",{ref:P,className:"sheet-handle",children:e.jsx("div",{className:"sheet-handle-bar"})}),e.jsxs("div",{ref:W,className:"sheet-content",children:[e.jsxs("div",{className:"sheet-section",children:[e.jsx("h4",{children:"Zoom"}),e.jsxs("div",{className:"sheet-zoom-controls",children:[e.jsx("button",{className:"zoom-btn",onClick:()=>u(Math.max(.25,m.zoom-.25)),"aria-label":"Zoom out",children:"âˆ’"}),e.jsxs("span",{className:"zoom-value",children:[Math.round(m.zoom*100),"%"]}),e.jsx("button",{className:"zoom-btn",onClick:()=>u(Math.min(2,m.zoom+.25)),"aria-label":"Zoom in",children:"+"}),e.jsx("button",{className:"zoom-btn reset",onClick:()=>j(window.innerWidth,window.innerHeight),"aria-label":"Reset view",children:"âŒ–"})]})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("h4",{children:"Views"}),e.jsxs("div",{className:"sheet-buttons",children:[e.jsxs("button",{className:`sheet-btn ${z==="canvas"?"active":""}`,onClick:()=>de("canvas"),children:[e.jsx("span",{className:"icon",children:"ðŸŽ¨"}),"Canvas"]}),e.jsxs("button",{className:`sheet-btn ${z==="guests"?"active":""}`,onClick:()=>de("guests"),children:[e.jsx("span",{className:"icon",children:"ðŸ‘¥"}),"Guests"]}),e.jsxs("button",{className:`sheet-btn ${z==="dashboard"?"active":""}`,onClick:()=>de("dashboard"),children:[e.jsx("span",{className:"icon",children:"ðŸ“Š"}),"Stats"]}),e.jsxs("button",{className:"sheet-btn",onClick:()=>{c(),V()},children:[e.jsx("span",{className:"icon",children:"ðŸ“¥"}),"Import"]})]})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("h4",{children:"Canvas Tools"}),e.jsxs("div",{className:"sheet-buttons",children:[e.jsxs("button",{className:`sheet-btn ${p.showGrid?"active":""}`,onClick:y,children:[e.jsx("span",{className:"icon",children:"ðŸ”²"}),"Grid"]}),e.jsxs("button",{className:`sheet-btn ${p.snapToGrid?"active":""}`,onClick:x,children:[e.jsx("span",{className:"icon",children:"ðŸ§²"}),"Snap"]}),e.jsxs("button",{className:`sheet-btn ${p.showAlignmentGuides?"active":""}`,onClick:C,children:[e.jsx("span",{className:"icon",children:"ðŸ“"}),"Guides"]}),e.jsxs("button",{className:`sheet-btn ${s?"active":""}`,onClick:()=>{d(),V()},children:[e.jsx("span",{className:"icon",children:"ðŸ”—"}),"Relations"]})]})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("h4",{children:"Settings"}),e.jsxs("div",{className:"sheet-buttons",children:[e.jsxs("button",{className:"sheet-btn",onClick:R,children:[e.jsx("span",{className:"icon",children:oe()}),te()]}),f&&e.jsxs("button",{className:"sheet-btn",onClick:()=>{f(),V()},children:[e.jsx("span",{className:"icon",children:"âŒ¨ï¸"}),"Shortcuts"]}),k&&e.jsxs("button",{className:"sheet-btn",onClick:()=>{k("quick-start"),V()},children:[e.jsx("span",{className:"icon",children:"ðŸŽ“"}),"Tour"]}),e.jsxs("button",{className:"sheet-btn",onClick:()=>{l("/events"),V()},children:[e.jsx("span",{className:"icon",children:"ðŸ“‹"}),"Events"]})]})]})]})]})]})}function ps({children:t,showRelationships:n,onToggleRelationships:s,onShowImport:d,isGuestPanelOpen:c=!1,onOpenGuestPanel:a,onCloseGuestPanel:h}){const l=Xe(),{event:o,hasSeenImmersiveHint:m,setHasSeenImmersiveHint:p,hasSeenLandscapeHint:u,setHasSeenLandscapeHint:j}=F(),y=Yt(),[x,C]=r.useState(!1),[I,R]=r.useState(!1),[z,Y]=r.useState(!1),[f,k]=r.useState(!1),b=r.useCallback(()=>{C(!0),R(!1),h?.(),Y(!1)},[h]),T=r.useCallback(()=>{R(!0),C(!1),h?.(),Y(!1)},[h]),M=r.useCallback(()=>{a?.(),C(!1),R(!1),Y(!1)},[a]);r.useEffect(()=>{if(!m){const X=setTimeout(()=>{Y(!0)},1e3);return()=>clearTimeout(X)}},[m]),r.useEffect(()=>{if(z){const X=setTimeout(()=>{Y(!1),p()},5e3);return()=>clearTimeout(X)}},[z,p]),r.useEffect(()=>{if(y||u||!m||z)return;const X=setTimeout(()=>{k(!0)},2e3);return()=>clearTimeout(X)},[y,u,m,z]),r.useEffect(()=>{if(!f)return;if(y){j(),requestAnimationFrame(()=>k(!1));return}const X=setTimeout(()=>{k(!1),j()},5e3);return()=>clearTimeout(X)},[f,y,j]),fe({onDrag:({movement:[X,E],velocity:[P,W],direction:[K,ee],active:V,event:de})=>{if(V)return;const oe=Math.abs(E)>Math.abs(X),te=Q.DISTANCE_THRESHOLD,Z=Q.VELOCITY_THRESHOLD;if(x&&oe&&ee<0&&(W>Z||Math.abs(E)>te)){C(!1);return}if(I&&oe&&ee>0&&(W>Z||E>te)){R(!1);return}if(c&&!oe&&K>0&&(P>Z||X>te)){h?.();return}if(x||I||c)return;const B=de?.target;if(!(B&&(B.closest(".mobile-fab")||B.closest(".corner-indicator")||B.closest(".transient-top-bar")||B.closest(".bottom-control-sheet")||B.closest(".mobile-guest-panel")||B.closest("button")||B.closest("input")))){if(oe){if(ee>0&&(W>Z||E>te)){b();return}if(ee<0&&(W>Z||Math.abs(E)>te)){T();return}}else if(K<0&&(P>Z||Math.abs(X)>te)&&a){M();return}}}},{target:typeof window<"u"?window:void 0,drag:{pointer:{touch:!0},filterTaps:!0,threshold:10}});const v=()=>{C(!1),R(!1)},N=()=>{b(),p()},w=()=>{l("/events")};return e.jsxs("div",{className:"mobile-immersive-canvas","data-landscape":y?"true":"false",children:[y&&e.jsxs("div",{className:"landscape-header",children:[e.jsx("button",{className:"landscape-back-btn",onClick:w,"aria-label":"Back to events",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})})}),e.jsx("span",{className:"landscape-event-name",children:o.name||"Untitled Event"}),e.jsxs("div",{className:"landscape-actions",children:[e.jsx("button",{className:"landscape-action-btn",onClick:M,"aria-label":"Open guest panel",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})})}),e.jsx("button",{className:"landscape-action-btn",onClick:T,"aria-label":"Open settings",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})})})]})]}),t,!y&&e.jsx(ms,{isVisible:x,onClose:v,onOpenSettings:T}),e.jsx(vs,{isVisible:I,onClose:v,showRelationships:n,onToggleRelationships:s,onShowImport:d}),!y&&e.jsx("button",{className:"corner-indicator",onClick:N,"aria-label":"Show controls",children:e.jsx("span",{className:"indicator-dot"})}),z&&!y&&e.jsx("div",{className:"immersive-hint",children:e.jsxs("div",{className:"hint-content",children:[e.jsx("p",{children:e.jsx("strong",{children:"Swipe to access controls"})}),e.jsx("p",{children:"â†“ Down for nav â€¢ â†‘ Up for tools"})]})}),f&&!y&&e.jsx("div",{className:"landscape-hint",onClick:()=>{k(!1),j()},children:e.jsxs("div",{className:"landscape-hint-content",children:[e.jsx("svg",{className:"rotate-icon",viewBox:"0 0 24 24",width:"24",height:"24",children:e.jsx("path",{fill:"currentColor",d:"M16.48 2.52c3.27 1.55 5.61 4.72 5.97 8.48h1.5C23.44 4.84 18.29 0 12 0l-.66.03 3.81 3.81 1.33-1.32zm-6.25-.77c-.59-.59-1.54-.59-2.12 0L1.75 8.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12L10.23 1.75zm4.6 19.44L2.81 9.17l6.36-6.36 12.02 12.02-6.36 6.38zm-7.31.29C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03-3.81-3.81-1.33 1.32z"})}),e.jsx("span",{children:"Rotate for more canvas space"})]})}),!y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"edge-hint top"}),e.jsx("div",{className:"edge-hint bottom"})]})]})}function gs(){const[t,n]=r.useState(!1);return{isOpen:t,onOpen:()=>n(!0),onClose:()=>n(!1)}}const fs=80,xs=10,bs=40;function et(t,n,s){return Math.round(t/n)*n}function js(t,n,s,d,c){const a=[],h=n+t.width/2,l=s+t.height/2,o=n,m=n+t.width,p=s,u=s+t.height;for(const j of d){if(j.id===t.id)continue;const y=j.x+j.width/2,x=j.y+j.height/2,C=j.x,I=j.x+j.width,R=j.y,z=j.y+j.height;Math.abs(l-x)<c&&a.push({type:"horizontal",position:x,start:Math.min(o,C)-20,end:Math.max(m,I)+20}),Math.abs(p-R)<c&&a.push({type:"horizontal",position:R,start:Math.min(o,C)-20,end:Math.max(m,I)+20}),Math.abs(u-z)<c&&a.push({type:"horizontal",position:z,start:Math.min(o,C)-20,end:Math.max(m,I)+20}),Math.abs(h-y)<c&&a.push({type:"vertical",position:y,start:Math.min(p,R)-20,end:Math.max(u,z)+20}),Math.abs(o-C)<c&&a.push({type:"vertical",position:C,start:Math.min(p,R)-20,end:Math.max(u,z)+20}),Math.abs(m-I)<c&&a.push({type:"vertical",position:I,start:Math.min(p,R)-20,end:Math.max(u,z)+20})}return a}function ze(t,n,s){for(const d of s){const c=d.x+d.width/2,a=d.y+d.height/2;let h;if(d.shape==="round"){const l=d.width/2,o=t-c,m=n-a;h=Math.sqrt(o*o+m*m)-l}else{const l=Math.max(Math.abs(t-c)-d.width/2,0),o=Math.max(Math.abs(n-a)-d.height/2,0);h=Math.sqrt(l*l+o*o)}if(h<fs)return d}return null}function lt(t,n){return!(t.x+t.width<n.x||n.x+n.width<t.x||t.y+t.height<n.y||n.y+n.height<t.y)}function ys(t,n,s){const d={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),width:Math.abs(n.x-t.x),height:Math.abs(n.y-t.y)};return s.filter(c=>lt(d,c)).map(c=>c.id)}function ot(t,n){const s=[];if(t.shape==="round"||t.shape==="oval"){const d=t.width/2+20,c=t.shape==="oval"?t.height/2+20:d;for(let a=0;a<n;a++){const h=2*Math.PI*a/n-Math.PI/2;s.push({x:t.x+t.width/2+d*Math.cos(h),y:t.y+t.height/2+c*Math.sin(h)})}}else{const d=Math.ceil(n/2),c=t.width/(d+1);for(let a=0;a<d;a++)s.push({x:t.x+c*(a+1),y:t.y-20});for(let a=0;a<n-d;a++)s.push({x:t.x+c*(a+1),y:t.y+t.height+20})}return s}function ws(t,n,s,d){const c={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),width:Math.abs(n.x-t.x),height:Math.abs(n.y-t.y)},a=40,h=new Map,l=new Map;for(const o of d){const m=ot(o,o.capacity);h.set(o.id,m);const p=s.filter(j=>j.tableId===o.id),u=new Map;p.forEach((j,y)=>{const x=j.seatIndex??y;u.set(j.id,x)}),l.set(o.id,u)}return s.filter(o=>{let m,p;if(o.tableId){const j=h.get(o.tableId),y=l.get(o.tableId);if(j&&y){const x=y.get(o.id)??0,C=j[x]||j[0];C&&(m=C.x,p=C.y)}}else o.canvasX!==void 0&&o.canvasY!==void 0&&(m=o.canvasX,p=o.canvasY);if(m===void 0||p===void 0)return!1;const u={x:m-a/2,y:p-a/2,width:a,height:a};return lt(c,u)}).map(o=>o.id)}function Ns(t,n,s,d,c){let a=null,h=bs;for(const l of s){const o=d.filter(p=>p.tableId===l.id);if(o.length===0)continue;const m=ot(l,l.capacity);for(const p of o){if(p.id===c)continue;const u=p.seatIndex??o.indexOf(p),j=m[u]||m[0];if(!j)continue;const y=t-j.x,x=n-j.y,C=Math.sqrt(y*y+x*x);C<h&&(h=C,a=p)}}return a}function $s(){const t=r.useRef(null),{event:n,canvas:s,canvasPrefs:d,alignmentGuides:c,contextMenu:a,setZoom:h,setPan:l,moveTable:o,assignGuestToTable:m,moveGuestOnCanvas:p,detachGuestFromTable:u,addTable:j,selectTable:y,selectGuest:x,setAlignmentGuides:C,clearAlignmentGuides:I,pushHistory:R,addQuickGuest:z,swapGuestSeats:Y,removeTable:f,removeGuest:k,openContextMenu:b,closeContextMenu:T,toggleTableSelection:M,toggleGuestSelection:v,setEditingGuest:N,selectMultipleItems:w,panToPosition:X,newlyAddedGuestId:E,clearNewlyAddedGuest:P,newlyAddedTableId:W,clearNewlyAddedTable:K,activeTourId:ee}=F(),{onShowHelp:V,onStartTour:de,onSubscribe:oe,canShowEmailButton:te}=st(),Z=Ae(),B=gs(),[q,ne]=r.useState(!1),[he,H]=r.useState({x:0,y:0}),[O,U]=r.useState(null),[ae,se]=r.useState(null),[ue,ke]=r.useState(null),[Ne,me]=r.useState(null),[xe,Ie]=r.useState(!1),[be,Re]=r.useState(!1),[ct,De]=r.useState(!1),[Oe,Be]=r.useState(null),[rt,dt]=r.useState(!1),He=r.useRef(null),[ve,qe]=r.useState(!1),[J,We]=r.useState(null),[ie,Ge]=r.useState(null),[Ue,ht]=r.useState("replace"),Ee=r.useRef(!1),_e=r.useCallback(()=>{const i=n.tables;if(i.length===0){l(50,20),h(1);return}let g=1/0,S=1/0,D=-1/0,G=-1/0;for(const ge of i)g=Math.min(g,ge.x),S=Math.min(S,ge.y),D=Math.max(D,ge.x+ge.width),G=Math.max(G,ge.y+ge.height);const L=100;g-=L,S-=L,D+=L,G+=L;const $=t.current?.clientWidth||800,A=t.current?.clientHeight||600,_=D-g,le=G-S,je=$/_,Ye=A/le,pe=Math.min(Math.max(Math.min(je,Ye),.25),2),St=(g+D)/2,zt=(S+G)/2,Tt=$/2-St*pe,kt=A/2-zt*pe;h(pe),l(Tt,kt)},[n.tables,l,h]);r.useLayoutEffect(()=>{n.tables.length>0&&_e(),dt(!0)},[]),r.useEffect(()=>{const i=g=>{He.current&&!He.current.contains(g.target)&&Ie(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const Fe=r.useRef(n.guests.length);r.useEffect(()=>{if(n.guests.length>Fe.current&&s.selectedGuestIds.length===1&&t.current){const i=s.selectedGuestIds[0],g=n.guests.find(S=>S.id===i);if(g&&g.canvasX!==void 0&&g.canvasY!==void 0){const S=t.current.getBoundingClientRect(),D=S.width,G=S.height,L=g.canvasX*s.zoom+s.panX,$=g.canvasY*s.zoom+s.panY;L>=0&&L<=D&&$>=0&&$<=G||X(g.canvasX+100,g.canvasY,D,G)}}Fe.current=n.guests.length},[n.guests.length,s.selectedGuestIds,s.zoom,s.panX,s.panY,n.guests,X]),r.useEffect(()=>{if(E){const i=setTimeout(()=>{P()},1500);return()=>clearTimeout(i)}},[E,P]),r.useEffect(()=>{if(W){const i=setTimeout(()=>{K()},1500);return()=>clearTimeout(i)}},[W,K]);const ut=At(Je(Ot,{activationConstraint:{distance:8}}),Je(Vt,{activationConstraint:{delay:200,tolerance:5}})),Qe=r.useRef(null),mt=r.useRef(s.zoom),vt=r.useRef({x:s.panX,y:s.panY});fe({onPinchStart:()=>{mt.current=s.zoom,vt.current={x:s.panX,y:s.panY}},onPinch:({offset:[i],origin:[g,S],memo:D})=>{const G=Math.min(2,Math.max(.25,i));D||(D={originX:(g-s.panX)/s.zoom,originY:(S-s.panY)/s.zoom});const L=g-D.originX*G,$=S-D.originY*G;return h(G),l(L,$),D},onDrag:({delta:[i,g],touches:S,pinching:D,event:G,target:L})=>{if(S>=2&&!D){G?.preventDefault(),l(s.panX+i,s.panY+g);return}const $=Z||d.panMode;if(S===1&&$&&!D){const A=L;A?.closest?.(".table-component")||A?.closest?.(".canvas-guest")||A?.closest?.(".seat-guest")||A?.closest?.("button")||(G?.preventDefault(),l(s.panX+i,s.panY+g))}}},{target:Qe,eventOptions:{passive:!1},pinch:{scaleBounds:{min:.25,max:2},from:()=>[s.zoom,0]},drag:{pointer:{touch:!0},filterTaps:!0,threshold:10}});const pt=r.useCallback(i=>{if(i.ctrlKey||i.metaKey){i.preventDefault();const g=i.deltaY>0?-.1:.1;h(s.zoom+g)}else l(s.panX-i.deltaX,s.panY-i.deltaY)},[s.zoom,s.panX,s.panY,h,l]),gt=r.useCallback(i=>{if(i.button===1||i.button===0&&i.altKey&&i.shiftKey){ne(!0),H({x:i.clientX-s.panX,y:i.clientY-s.panY});return}const g=i.target,S=g.closest(".table-component")||g.closest(".canvas-guest")||g.closest(".seat-guest")||g.closest("button")||g.closest(".context-menu");if(i.button===0&&!S&&t.current){const D=t.current.getBoundingClientRect(),G=(i.clientX-D.left-s.panX)/s.zoom,L=(i.clientY-D.top-s.panY)/s.zoom;qe(!0),We({x:G,y:L}),Ge({x:G,y:L}),ht(i.shiftKey?"add":"replace"),i.preventDefault()}},[s.panX,s.panY,s.zoom]),ft=r.useCallback(i=>{if(q){l(i.clientX-he.x,i.clientY-he.y);return}if(ve&&J&&t.current){const g=t.current.getBoundingClientRect(),S=(i.clientX-g.left-s.panX)/s.zoom,D=(i.clientY-g.top-s.panY)/s.zoom;Ge({x:S,y:D})}},[q,he,l,ve,J,s.panX,s.panY,s.zoom]),Ke=r.useCallback(()=>{if(q){ne(!1);return}if(ve&&J&&ie){const i=ys(J,ie,n.tables),g=ws(J,ie,n.guests,n.tables),S=Math.abs(ie.x-J.x),D=Math.abs(ie.y-J.y);if(S>5||D>5)if(Ee.current=!0,Ue==="add"){const L=[...new Set([...s.selectedTableIds,...i])],$=[...new Set([...s.selectedGuestIds,...g])];w(L,$)}else w(i,g);qe(!1),We(null),Ge(null)}},[q,ve,J,ie,Ue,n.tables,n.guests,s.selectedTableIds,s.selectedGuestIds,w]),xt=i=>{const{active:g}=i,S=g.data.current?.type;S==="guest"||S==="canvas-guest"||S==="seated-guest"?(U(g.id),me(S)):S==="table"&&(me(S),R("Move table"))},bt=i=>{const{active:g,delta:S}=i,D=g.data.current?.type;if(D==="table"){const G=n.tables.find(A=>A.id===g.id);if(!G)return;const L=G.x+S.x/s.zoom,$=G.y+S.y/s.zoom;if(d.showAlignmentGuides){const A=js(G,L,$,n.tables,xs);C(A)}}else if(D==="canvas-guest"){const G=n.guests.find(_=>_.id===g.id);if(!G||G.canvasX===void 0||G.canvasY===void 0)return;const L=G.canvasX+S.x/s.zoom,$=G.canvasY+S.y/s.zoom,A=ze(L,$,n.tables);se(A?.id||null)}else if(D==="seated-guest"){const G=g.data.current?.originalPosition;if(!G)return;const L=G.canvasX+S.x/s.zoom,$=G.canvasY+S.y/s.zoom,A=Ns(L,$,n.tables,n.guests,g.id);if(ke(A?.id||null),A)se(null);else{const _=ze(L,$,n.tables);se(_?.id||null)}}},jt=i=>{const{active:g,over:S,delta:D}=i,G=ue;U(null),se(null),ke(null),me(null),I();const L=g.data.current?.type;if(L==="table"){const $=n.tables.find(A=>A.id===g.id);if($){let A=$.x+D.x/s.zoom,_=$.y+D.y/s.zoom;d.snapToGrid&&(A=et(A,d.gridSize),_=et(_,d.gridSize)),o(g.id,A,_)}}else if(L==="canvas-guest"){const $=n.guests.find(je=>je.id===g.id);if(!$||$.canvasX===void 0||$.canvasY===void 0)return;const A=$.canvasX+D.x/s.zoom,_=$.canvasY+D.y/s.zoom,le=ze(A,_,n.tables);le?m(g.id,le.id):p(g.id,A,_)}else if(L==="seated-guest"){const $=g.data.current?.originalPosition;if(!$)return;const A=$.canvasX+D.x/s.zoom,_=$.canvasY+D.y/s.zoom;if(G){R("Swap guests"),Y(g.id,G);return}const le=ze(A,_,n.tables);le?m(g.id,le.id):u(g.id,A,_)}else if(L==="guest"){if(S?.data.current?.type==="table")m(g.id,S.id);else if(!S&&t.current?.getBoundingClientRect()){const A=n.guests.find(le=>le.id===g.id);if(!(A?.canvasX!==void 0&&A?.canvasY!==void 0)){const le=n.guests.filter(pe=>!pe.tableId&&pe.id!==g.id),je=80,Ye=100+le.length*70;p(g.id,je,Ye)}m(g.id,void 0)}}},yt=i=>{if(Ee.current){Ee.current=!1;return}i.target===t.current&&y(null)},wt=i=>{const g=window.innerWidth-280,S=window.innerHeight-120,D=g/2-(i.x+i.width/2)*s.zoom,G=S/2-(i.y+i.height/2)*s.zoom;l(D,G),y(i.id),Ie(!1)},Nt=()=>{if(!a.targetType)return[];if(a.targetType==="table"&&a.targetId){const i=n.tables.find(L=>L.id===a.targetId);if(!i)return[];const g=n.guests.filter(L=>L.tableId===i.id).length,S=s.selectedTableIds.includes(i.id),D=s.selectedTableIds.length>1;return[{label:S?"Deselect":"Select",icon:S?"â—‹":"â—",onClick:()=>y(S?null:i.id)},{label:"Add to Selection",icon:"+",onClick:()=>M(i.id),disabled:S},{label:"",onClick:()=>{},divider:!0},{label:"Duplicate Table",icon:"â§‰",onClick:()=>{R("Duplicate table"),j(i.shape,i.x+50,i.y+50)}},{label:"Generate QR Code",icon:"ðŸ“±",onClick:()=>Be(i.id)},{label:"",onClick:()=>{},divider:!0},{label:D?`Delete ${s.selectedTableIds.length} Tables`:"Delete Table",icon:"ðŸ—‘",onClick:()=>{confirm(`Delete ${i.name}?${g>0?` ${g} guest(s) will be unassigned.`:""}`)&&(R("Delete table"),f(i.id))},danger:!0}]}if(a.targetType==="guest"&&a.targetId){const i=n.guests.find(D=>D.id===a.targetId);if(!i)return[];const g=s.selectedGuestIds.includes(i.id),S=[{label:"Edit Guest",icon:"âœï¸",onClick:()=>N(i.id)},{label:"",onClick:()=>{},divider:!0},{label:g?"Deselect":"Select",icon:g?"â—‹":"â—",onClick:()=>x(g?null:i.id)},{label:"Add to Selection",icon:"+",onClick:()=>v(i.id),disabled:g},{label:"",onClick:()=>{},divider:!0}];return n.tables.length>0&&S.push({label:"Unassign from Table",icon:"â†©",onClick:()=>{R("Unassign guest"),m(i.id,void 0)},disabled:!i.tableId}),S.push({label:"",onClick:()=>{},divider:!0}),S.push({label:"Delete Guest",icon:"ðŸ—‘",onClick:()=>{confirm(`Delete ${re(i)}?`)&&(R("Delete guest"),k(i.id))},danger:!0}),S}return a.targetType==="canvas"?[{label:"Add Round Table",icon:"â­•",onClick:()=>{const i=(a.x-s.panX)/s.zoom,g=(a.y-s.panY)/s.zoom;j("round",i,g)}},{label:"Add Rectangle Table",icon:"â–­",onClick:()=>{const i=(a.x-s.panX)/s.zoom,g=(a.y-s.panY)/s.zoom;j("rectangle",i,g)}},{label:"Add Guest",icon:"ðŸ‘¤",onClick:()=>{const i=(a.x-s.panX)/s.zoom,g=(a.y-s.panY)/s.zoom;z(i,g)}},{label:"",onClick:()=>{},divider:!0},{label:"Select All Tables",icon:"âŠž",onClick:()=>{n.tables.map(g=>g.id).forEach(g=>M(g))},disabled:n.tables.length===0}]:[]},Ct=i=>{i.preventDefault(),(i.target===i.currentTarget||i.target.classList.contains("canvas-content"))&&b(i.clientX,i.clientY,"canvas",null)},Mt=Te({onLongPress:i=>{const g=i.target;if(g.classList.contains("canvas-viewport")||g.classList.contains("canvas-content")){i.preventDefault();const S=i.touches[0]||i.changedTouches[0];S&&b(S.clientX,S.clientY,"canvas",null)}}}),$e=O?n.guests.find(i=>i.id===O):null,Ze=e.jsxs(e.Fragment,{children:[e.jsxs(Xt,{sensors:ut,onDragStart:xt,onDragMove:bt,onDragEnd:jt,children:[e.jsxs("div",{ref:i=>{t.current=i,Qe.current=i},className:`canvas ${d.showGrid?"show-grid":""}`,onWheel:pt,onMouseDown:gt,onMouseMove:ft,onMouseUp:Ke,onMouseLeave:Ke,onClick:yt,onContextMenu:Ct,...Mt,style:{cursor:q?"grabbing":ve?"crosshair":"default",touchAction:"none"},children:[e.jsxs("div",{className:"canvas-content",style:{transform:`translate(${s.panX}px, ${s.panY}px) scale(${s.zoom})`,transformOrigin:"0 0",opacity:rt?1:0},children:[n.tables.map(i=>e.jsx(Qt,{table:i,guests:n.guests.filter(g=>g.tableId===i.id),isSelected:s.selectedTableIds.includes(i.id),isSnapTarget:ae===i.id,swapTargetGuestId:ue,isNewlyAdded:W===i.id},i.id)),n.guests.filter(i=>!i.tableId&&i.canvasX!==void 0&&i.canvasY!==void 0).map(i=>e.jsx(Zt,{guest:i,isSelected:s.selectedGuestIds.includes(i.id),isNearTable:ae!==null&&O===i.id,isNewlyAdded:E===i.id},i.id)),c.map((i,g)=>e.jsx("div",{className:`alignment-guide alignment-guide-${i.type}`,style:i.type==="horizontal"?{top:i.position,left:i.start,width:i.end-i.start}:{left:i.position,top:i.start,height:i.end-i.start}},`guide-${g}`)),ve&&J&&ie&&e.jsx("div",{className:"selection-rectangle",style:{left:Math.min(J.x,ie.x),top:Math.min(J.y,ie.y),width:Math.abs(ie.x-J.x),height:Math.abs(ie.y-J.y)}})]}),d.showGrid&&e.jsx("div",{className:"canvas-grid-overlay",style:{backgroundSize:`${d.gridSize*s.zoom}px ${d.gridSize*s.zoom}px`,backgroundPosition:`${s.panX}px ${s.panY}px`}}),n.tables.length===0&&n.guests.filter(i=>!i.tableId).length===0&&e.jsxs("div",{className:"canvas-empty",children:[e.jsx("h2",{children:"Welcome to Seatify!"}),e.jsx("p",{children:'Click "Add Table" above to create tables, then drag guests from the sidebar to assign seats.'})]})]}),e.jsx(Pt,{children:$e&&(Ne==="canvas-guest"||Ne==="seated-guest"?e.jsx("div",{className:"canvas-guest-overlay",children:e.jsx("div",{className:"canvas-guest-circle",children:e.jsx("span",{className:"initials",children:we($e)})})}):e.jsx(qt,{guest:$e,isDragging:!0}))})]}),e.jsx(ts,{}),e.jsx(es,{}),e.jsx(Jt,{}),e.jsx(ss,{}),e.jsx(as,{}),a.isOpen&&e.jsx(ns,{x:a.x,y:a.y,items:Nt(),onClose:T}),be&&e.jsxs("div",{className:"relationships-panel",children:[e.jsxs("div",{className:"relationships-panel-header",children:[e.jsx("h3",{children:"Guest Relationships"}),e.jsx("button",{className:"close-btn",onClick:()=>Re(!1),children:"Ã—"})]}),e.jsx(Wt,{})]}),e.jsx(Ut,{isOpen:ct,onClose:()=>De(!1)}),Oe&&e.jsx(it,{tableId:Oe,onClose:()=>Be(null)})]});return Z&&!ee?e.jsx("div",{className:"canvas-container mobile-immersive",children:e.jsxs(ps,{showRelationships:be,onToggleRelationships:()=>Re(!be),onShowImport:()=>De(!0),isGuestPanelOpen:B.isOpen,onOpenGuestPanel:B.onOpen,onCloseGuestPanel:B.onClose,children:[Ze,e.jsx(ls,{onAddGuest:()=>{const i=(window.innerWidth/2-s.panX)/s.zoom,g=(window.innerHeight/2-s.panY)/s.zoom;z(i,g)},isHidden:!!O||q||B.isOpen}),e.jsx(us,{isOpen:B.isOpen,onOpen:B.onOpen,onClose:B.onClose})]})}):e.jsxs("div",{className:"canvas-container",children:[e.jsxs(_t,{showRelationships:be,onToggleRelationships:()=>Re(!be),onImport:()=>De(!0),onShowHelp:V,onStartTour:de,onSubscribe:oe,canShowEmailButton:te,children:[e.jsx(is,{}),n.tables.length>0&&e.jsxs("div",{className:"table-nav-dropdown",ref:He,children:[e.jsx("button",{onClick:()=>Ie(!xe),className:"toolbar-btn",children:"Go to Table"}),xe&&e.jsx("div",{className:"dropdown-menu",children:n.tables.map(i=>{const g=n.guests.filter(D=>D.tableId===i.id).length,S=g>=i.capacity;return e.jsxs("button",{onClick:()=>wt(i),className:`table-nav-item ${S?"full":""}`,children:[e.jsx("span",{className:"table-nav-name",children:i.name}),e.jsxs("span",{className:"table-nav-count",children:[g,"/",i.capacity]})]},i.id)})})]}),e.jsxs("div",{className:"zoom-controls",children:[e.jsx("button",{onClick:()=>h(s.zoom-.1),title:"Zoom Out",children:"âˆ’"}),e.jsxs("span",{className:"zoom-display",children:[Math.round(s.zoom*100),"%"]}),e.jsx("button",{onClick:()=>h(s.zoom+.1),title:"Zoom In",children:"+"}),e.jsx("button",{onClick:_e,className:"recenter-btn has-tooltip","data-tooltip":"Re-center",children:"âŒ–"})]})]}),Ze]})}export{$s as Canvas};
