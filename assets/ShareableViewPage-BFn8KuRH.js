import{j as e,g as V,A as H,a as _,D as J,z as ae,B as ie}from"./index-Ch-N2Ac2.js";import{r as g,d as re,u as oe}from"./react-vendor-DSgMQvCA.js";import{u as ce}from"./gesture-BYLw3qxJ.js";import{g as Z}from"./groupColors-DijypUJV.js";import"./pdf-export-BqwfyxvF.js";import"./compression-B61UvNVp.js";import"./qrcode-CZEObl3k.js";function le(t,d){const p=[];if(t.shape==="round"||t.shape==="oval"){const u=t.width/2+20,h=t.shape==="oval"?t.height/2+20:u;for(let l=0;l<d;l++){const y=2*Math.PI*l/d-Math.PI/2;p.push({x:t.x+t.width/2+u*Math.cos(y),y:t.y+t.height/2+h*Math.sin(y)})}}else if(t.shape==="half-round"){const u=t.width/2+20;for(let h=0;h<d;h++){const l=Math.PI+Math.PI*h/(d-1||1);p.push({x:t.x+t.width/2+u*Math.cos(l),y:t.y+t.height/2+u*Math.sin(l)})}}else{const u=Math.ceil(d/2),h=t.width/(u+1);for(let l=0;l<u;l++)p.push({x:t.x+h*(l+1),y:t.y-20});for(let l=0;l<d-u;l++)p.push({x:t.x+h*(l+1),y:t.y+t.height+20})}return p}function q(t){if(!t||t.length===0)return null;for(const d of t){const p=J[d.toLowerCase()];if(p)return p}return"ðŸ½ï¸"}function K(t){switch(t){case"confirmed":return"var(--color-success)";case"declined":return"var(--color-error)";default:return"var(--color-warning)"}}function de(t,d,p){const u=[];for(const h of p){const l=h.priority==="optional"?"preferred":h.priority||"preferred";if(h.type==="must_sit_together"){const y=h.guestIds,k=t.map(r=>r.id),j=y.filter(r=>k.includes(r));if(j.length>0&&j.length<y.length){const r=y.map(I=>{const m=d.find(C=>C.id===I);return m?_(m):"Unknown"});u.push({description:`${r.join(" & ")} should sit together`,priority:l})}}else if(h.type==="must_not_sit_together"){const y=h.guestIds,k=t.map(r=>r.id),j=y.filter(r=>k.includes(r));if(j.length>1){const r=j.map(I=>{const m=d.find(C=>C.id===I);return m?_(m):"Unknown"});u.push({description:`${r.join(" & ")} should not sit together`,priority:l})}}}return u}function he({tables:t,guests:d,venueElements:p=[],constraints:u=[],eventName:h,showGrid:l=!0}){const y=g.useRef(null),k=g.useRef(null),[j,r]=g.useState(1),[I,m]=g.useState(50),[C,N]=g.useState(50),[A,E]=g.useState(!1),[z,Q]=g.useState(l),[L,U]=g.useState(null);g.useLayoutEffect(()=>{if(t.length===0){E(!0);return}let s=1/0,n=1/0,o=-1/0,a=-1/0;for(const x of t)s=Math.min(s,x.x),n=Math.min(n,x.y),o=Math.max(o,x.x+x.width),a=Math.max(a,x.y+x.height);const i=100;s-=i,n-=i,o+=i,a+=i;const f=y.current?.clientWidth||800,w=y.current?.clientHeight||600,$=o-s,v=a-n,Y=f/$,R=w/v,M=Math.min(Math.max(Math.min(Y,R),.25),2),b=(s+o)/2,D=(n+a)/2,T=f/2-b*M,W=w/2-D*M;r(M),m(T),N(W),E(!0)},[t]),ce({onPinch:({offset:[s],origin:[n,o],memo:a})=>{const i=Math.min(2,Math.max(.25,s));a||(a={originX:(n-I)/j,originY:(o-C)/j});const f=n-a.originX*i,w=o-a.originY*i;return r(i),m(f),N(w),a},onDrag:({delta:[s,n],touches:o,pinching:a})=>{a||o>=1&&(m(i=>i+s),N(i=>i+n))}},{target:k,eventOptions:{passive:!1},pinch:{scaleBounds:{min:.25,max:2},from:()=>[j,0]},drag:{pointer:{touch:!0},filterTaps:!0,threshold:10}});const ee=g.useCallback(s=>{if(s.ctrlKey||s.metaKey){s.preventDefault();const n=s.deltaY>0?-.1:.1;r(o=>Math.min(2,Math.max(.25,o+n)))}else m(n=>n-s.deltaX),N(n=>n-s.deltaY)},[]),se=()=>{if(t.length===0){m(50),N(50),r(1);return}let s=1/0,n=1/0,o=-1/0,a=-1/0;for(const x of t)s=Math.min(s,x.x),n=Math.min(n,x.y),o=Math.max(o,x.x+x.width),a=Math.max(a,x.y+x.height);const i=100;s-=i,n-=i,o+=i,a+=i;const f=y.current?.clientWidth||800,w=y.current?.clientHeight||600,$=o-s,v=a-n,Y=f/$,R=w/v,M=Math.min(Math.max(Math.min(Y,R),.25),2),b=(s+o)/2,D=(n+a)/2,T=f/2-b*M,W=w/2-D*M;r(M),m(T),N(W)},te=s=>d.filter(n=>n.tableId===s),B=(s,n,o)=>{const a=s.tableId?t.find(f=>f.id===s.tableId):null,i=[_(s)];if(a&&(i[0]+=` (${a.name})`),s.rsvpStatus){const f=s.rsvpStatus.charAt(0).toUpperCase()+s.rsvpStatus.slice(1);i.push(`Status: ${f}`)}s.group&&i.push(`Group: ${s.group}`),s.dietaryRestrictions?.length&&i.push(`Diet: ${s.dietaryRestrictions.join(", ")}`),s.accessibilityNeeds?.length&&i.push(`Accessibility: ${s.accessibilityNeeds.join(", ")}`),U({x:n,y:o,content:i.join(`
`)})};return e.jsxs("div",{className:"readonly-canvas-container",children:[e.jsxs("div",{className:"readonly-canvas-header",children:[e.jsxs("div",{className:"readonly-header-left",children:[h&&e.jsx("h2",{className:"readonly-event-name",children:h}),e.jsxs("span",{className:"readonly-stats",children:[t.length," table",t.length!==1?"s":""," â€¢ ",d.length," guest",d.length!==1?"s":""]})]}),e.jsxs("div",{className:"readonly-header-right",children:[e.jsx("button",{className:`readonly-grid-toggle ${z?"active":""}`,onClick:()=>Q(!z),title:z?"Hide Grid":"Show Grid",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[e.jsx("rect",{x:"1",y:"1",width:"4",height:"4"}),e.jsx("rect",{x:"6",y:"1",width:"4",height:"4"}),e.jsx("rect",{x:"11",y:"1",width:"4",height:"4"}),e.jsx("rect",{x:"1",y:"6",width:"4",height:"4"}),e.jsx("rect",{x:"6",y:"6",width:"4",height:"4"}),e.jsx("rect",{x:"11",y:"6",width:"4",height:"4"}),e.jsx("rect",{x:"1",y:"11",width:"4",height:"4"}),e.jsx("rect",{x:"6",y:"11",width:"4",height:"4"}),e.jsx("rect",{x:"11",y:"11",width:"4",height:"4"})]})}),e.jsxs("div",{className:"readonly-zoom-controls",children:[e.jsx("button",{onClick:()=>r(s=>Math.max(.25,s-.1)),title:"Zoom Out",children:"âˆ’"}),e.jsxs("span",{className:"zoom-display",children:[Math.round(j*100),"%"]}),e.jsx("button",{onClick:()=>r(s=>Math.min(2,s+.1)),title:"Zoom In",children:"+"}),e.jsx("button",{onClick:se,className:"recenter-btn",title:"Re-center",children:"âŒ–"})]})]})]}),e.jsxs("div",{ref:s=>{y.current=s,k.current=s},className:`readonly-canvas ${z?"show-grid":""}`,onWheel:ee,style:{touchAction:"none"},children:[e.jsxs("div",{className:"readonly-canvas-content",style:{transform:`translate(${I}px, ${C}px) scale(${j})`,transformOrigin:"0 0",opacity:A?1:0},children:[p.map(s=>e.jsx("div",{className:`readonly-venue-element readonly-venue-${s.type}`,style:{left:s.x,top:s.y,width:s.width,height:s.height,transform:s.rotation?`rotate(${s.rotation}deg)`:void 0},children:e.jsx("span",{className:"venue-label",children:s.label})},s.id)),t.map(s=>{const n=te(s.id),o=le(s,s.capacity),a=de(n,d,u),i=a.length>0,f=a.some(c=>c.priority==="required"),w=n.length/s.capacity,$=n.length>s.capacity?"over":w>=1?"full":w>=.75?"nearly-full":"available",v=Math.max(s.width,s.height)+16,Y=v/2-4,R=2*Math.PI*Y,M=R*(1-Math.min(w,1)),b=(()=>{const c={};let S=0;return n.forEach(P=>{P.dietaryRestrictions?.forEach(X=>{const G=X.toLowerCase();c[G]=(c[G]||0)+1}),P.accessibilityNeeds?.length&&(S+=1)}),{dietary:c,accessibility:S}})(),D=Object.keys(b.dietary).length>0||b.accessibility>0,T=Object.values(b.dietary).reduce((c,S)=>c+S,0)+b.accessibility,W=()=>{const c=[];return Object.entries(b.dietary).forEach(([S,P])=>{const X=J[S]||"";c.push(`${X} ${S}: ${P}`)}),b.accessibility>0&&c.push(`${H} Accessibility: ${b.accessibility}`),c.join(`
`)},x=i?a.map(c=>`âš ï¸ ${c.description}`).join(`
`):"";return e.jsxs("div",{className:`readonly-table-wrapper capacity-${$} ${i?"has-violations":""} ${f?"has-required-violations":""}`,children:[s.shape==="round"&&e.jsxs("svg",{className:"readonly-capacity-ring",width:v,height:v,style:{position:"absolute",left:s.x+s.width/2-v/2,top:s.y+s.height/2-v/2,pointerEvents:"none"},children:[e.jsx("circle",{cx:v/2,cy:v/2,r:Y,fill:"none",stroke:"var(--color-border-light)",strokeWidth:"3"}),e.jsx("circle",{cx:v/2,cy:v/2,r:Y,fill:"none",className:`capacity-progress capacity-${$}`,strokeWidth:"3",strokeLinecap:"round",strokeDasharray:R,strokeDashoffset:M,style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsxs("div",{className:`readonly-table readonly-table-${s.shape} capacity-${$}`,style:{left:s.x,top:s.y,width:s.width,height:s.height,transform:s.rotation?`rotate(${s.rotation}deg)`:void 0},children:[e.jsx("span",{className:"table-name",children:s.name}),e.jsxs("span",{className:`table-count capacity-${$}`,children:[n.length,"/",s.capacity]}),i&&e.jsxs("div",{className:`readonly-violation-badge ${f?"required":"preferred"}`,title:x,children:["âš ï¸ ",a.length]}),D&&e.jsxs("div",{className:"readonly-dietary-summary",title:W(),children:[e.jsx("span",{className:"dietary-summary-icon",children:"ðŸ½ï¸"}),e.jsx("span",{className:"dietary-summary-count",children:T})]})]}),n.map((c,S)=>{const P=c.seatIndex??S,X=o[P]||o[0];if(!X)return null;const G=q(c.dietaryRestrictions),ne=c.accessibilityNeeds&&c.accessibilityNeeds.length>0,O=Z(c.group);return e.jsxs("div",{className:`readonly-guest ${O?"has-group":""}`,style:{left:X.x,top:X.y},onMouseEnter:F=>B(c,F.clientX,F.clientY),onMouseLeave:()=>U(null),children:[e.jsx("div",{className:"guest-circle",style:O?{borderColor:O,borderWidth:"3px"}:void 0,children:e.jsx("span",{className:"guest-initials",children:V(c)})}),e.jsx("span",{className:"status-dot",style:{backgroundColor:K(c.rsvpStatus)}}),O&&e.jsx("span",{className:"group-dot",style:{backgroundColor:O}}),G&&e.jsx("span",{className:"dietary-icon",children:G}),ne&&e.jsx("span",{className:"accessibility-icon",children:H})]},c.id)})]},s.id)}),d.filter(s=>!s.tableId&&s.canvasX!==void 0&&s.canvasY!==void 0).map(s=>{const n=q(s.dietaryRestrictions),o=s.accessibilityNeeds&&s.accessibilityNeeds.length>0,a=Z(s.group);return e.jsxs("div",{className:`readonly-guest readonly-guest-unassigned ${a?"has-group":""}`,style:{left:s.canvasX,top:s.canvasY},onMouseEnter:i=>B(s,i.clientX,i.clientY),onMouseLeave:()=>U(null),children:[e.jsx("div",{className:"guest-circle",style:a?{borderColor:a,borderWidth:"3px"}:void 0,children:e.jsx("span",{className:"guest-initials",children:V(s)})}),e.jsx("span",{className:"status-dot",style:{backgroundColor:K(s.rsvpStatus)}}),a&&e.jsx("span",{className:"group-dot",style:{backgroundColor:a}}),n&&e.jsx("span",{className:"dietary-icon",children:n}),o&&e.jsx("span",{className:"accessibility-icon",children:H})]},s.id)})]}),t.length===0&&d.length===0&&e.jsx("div",{className:"readonly-empty",children:e.jsx("p",{children:"No seating arrangement to display."})})]}),L&&e.jsx("div",{className:"readonly-tooltip",style:{left:L.x+10,top:L.y+10},children:L.content.split(`
`).map((s,n)=>e.jsx("div",{children:s},n))})]})}function je(){const{encodedData:t}=re(),d=oe(),p=g.useRef(null),[u,h]=g.useState(null),[l,y]=g.useState(!1),{eventData:k,error:j}=g.useMemo(()=>{if(!t)return{eventData:null,error:!1};const N=ae(t);return N?{eventData:N,error:!1}:{eventData:null,error:!0}},[t]),r=u||k,I=()=>{d("/events")},m=()=>{p.current?.click()},C=async N=>{const A=N.target.files?.[0];if(A){y(!0);try{const E=await ie(A);E?h(E):alert("Unable to read the seating file. Make sure it's a valid Seatify export.")}catch{alert("Error reading file.")}finally{y(!1),p.current&&(p.current.value="")}}};return!t&&!u?e.jsx("div",{className:"shareable-page",children:e.jsxs("div",{className:"shareable-container",children:[e.jsx("div",{className:"shareable-header",children:e.jsxs("h1",{className:"shareable-brand",children:[e.jsx("span",{className:"logo-seat",children:"Seat"}),e.jsx("span",{className:"logo-ify",children:"ify"})]})}),e.jsxs("div",{className:"shareable-upload-prompt",children:[e.jsx("div",{className:"upload-icon",children:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),e.jsx("h2",{children:"View Shared Seating Chart"}),e.jsx("p",{children:"Upload a Seatify seating file to view the arrangement."}),e.jsx("input",{ref:p,type:"file",accept:".json",onChange:C,style:{display:"none"}}),e.jsx("button",{className:"upload-btn",onClick:m,disabled:l,children:l?"Loading...":"Upload Seating File"}),e.jsx("button",{className:"secondary-btn",onClick:I,children:"Or create your own event"})]})]})}):j?e.jsx("div",{className:"shareable-page",children:e.jsxs("div",{className:"shareable-container",children:[e.jsx("div",{className:"shareable-header",children:e.jsxs("h1",{className:"shareable-brand",children:[e.jsx("span",{className:"logo-seat",children:"Seat"}),e.jsx("span",{className:"logo-ify",children:"ify"})]})}),e.jsxs("div",{className:"shareable-error",children:[e.jsx("div",{className:"error-icon",children:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),e.jsx("h2",{children:"Unable to load seating chart"}),e.jsx("p",{children:"The link may be corrupted or outdated. Try asking for a new share link."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("input",{ref:p,type:"file",accept:".json",onChange:C,style:{display:"none"}}),e.jsx("button",{className:"upload-btn",onClick:m,children:"Upload a file instead"}),e.jsx("button",{className:"secondary-btn",onClick:I,children:"Go to Seatify"})]})]})]})}):e.jsxs("div",{className:"shareable-page shareable-page-full",children:[e.jsxs("div",{className:"shareable-topbar",children:[e.jsxs("div",{className:"shareable-topbar-left",children:[e.jsxs("h1",{className:"shareable-brand-small",children:[e.jsx("span",{className:"logo-table",children:"Table"}),e.jsx("span",{className:"logo-craft",children:"Craft"})]}),e.jsx("span",{className:"shareable-badge",children:"Shared View"})]}),e.jsx("div",{className:"shareable-topbar-right",children:e.jsx("button",{className:"topbar-btn",onClick:I,children:"Create your own event"})})]}),e.jsx("div",{className:"shareable-canvas-wrapper",children:e.jsx(he,{tables:r?.tables||[],guests:r?.guests||[],venueElements:r?.venueElements,constraints:r?.constraints,eventName:r?.name})}),e.jsx("input",{ref:p,type:"file",accept:".json",onChange:C,style:{display:"none"}})]})}export{je as ShareableViewPage};
