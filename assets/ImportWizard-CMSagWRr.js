import{u as O,j as e,w as te,x as Ae,U as _e,h as $e,a as _,s as K}from"./index-BuuUsEeF.js";import{u as Q,d as Ie,r as f,a as J,g as Re}from"./react-vendor-DSgMQvCA.js";import{r as Me,a as Le,u as ze}from"./excel-import-eTqe3OYc.js";function Pe({showRelationships:s,onToggleRelationships:a}){const n=Q(),{eventId:t}=Ie(),{activeView:i,currentEventId:l}=O(),d=t||l,h=m=>{d&&n(`/events/${d}/${m}`)};return e.jsxs("div",{className:"view-toggle-container",children:[e.jsxs("div",{className:"view-toggle-switch",children:[e.jsxs("button",{className:`toggle-option ${i==="dashboard"?"active":""}`,onClick:()=>h("dashboard"),title:"Dashboard",children:[e.jsx("span",{className:"toggle-icon",children:"ðŸ“Š"}),e.jsx("span",{className:"toggle-text",children:"Dashboard"})]}),e.jsxs("button",{className:`toggle-option ${i==="canvas"?"active":""}`,onClick:()=>h("canvas"),title:"Canvas",children:[e.jsx("span",{className:"toggle-icon",children:"ðŸŽ¨"}),e.jsx("span",{className:"toggle-text",children:"Canvas"})]}),e.jsxs("button",{className:`toggle-option ${i==="guests"?"active":""}`,onClick:()=>h("guests"),title:"Guest List",children:[e.jsx("span",{className:"toggle-icon",children:"ðŸ‘¥"}),e.jsx("span",{className:"toggle-text",children:"Guests"})]})]}),a&&e.jsx("button",{className:`toggle-option relationships ${s?"active":""}`,onClick:a,children:"Relationships"})]})}function Ge({onAddGuest:s,onImport:a,showRelationships:n,onToggleRelationships:t,showGridControls:i,onToggleGridControls:l,onShowHelp:d,onStartTour:h,onSubscribe:m,canShowEmailButton:g}){const{event:p,addTable:c,activeView:u,setActiveView:r,optimizeSeating:o,resetSeating:x,hasOptimizationSnapshot:b,canvas:E,setZoom:A,recenterCanvas:R,theme:N,cycleTheme:y,currentEventId:C,isTourComplete:T}=O(),k=Q(),[S,w]=f.useState(!1),[P,z]=f.useState(!1),[$,j]=f.useState(!1),I=f.useRef(null),M=f.useRef(null),L=te("getting-started"),G=te("features"),F=p.guests.some(v=>v.relationships.length>0),he=p.tables.some(v=>v.capacity>0),pe=F&&he&&p.guests.length>1,ge=b();f.useEffect(()=>{const v=D=>{const U=D.target,W=I.current&&!I.current.contains(U),ke=!M.current||!M.current.contains(U);W&&ke&&(w(!1),z(!1),j(!1))};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]),f.useEffect(()=>{const v=D=>{D.key==="Escape"&&(w(!1),z(!1),j(!1))};if(S)return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[S]);const V=v=>{C&&k(`/events/${C}/${v}`),r(v),w(!1)},ee=v=>{C&&k(`/events/${C}/${v}`),r(v)},se=v=>{const D=p.tables.length+1,U=400+D*50%200,W=300+D*30%150;c(v,U,W),z(!1),w(!1)},xe=()=>{s(),w(!1)},fe=()=>{a&&(a(),w(!1))},be=()=>{o(),w(!1)},Ne=()=>{x(),w(!1)},je=()=>{t&&t()},ve=()=>{l&&(l(),w(!1))},ye=()=>{d&&(d(),w(!1))},ne=v=>{h&&(h(v),w(!1),j(!1))},we=()=>{m&&(m(),w(!1))},Ee=()=>{y()},Se=()=>{switch(N){case"light":return"Light";case"dark":return"Dark";default:return"System"}},Ce=()=>{switch(N){case"light":return"â˜€";case"dark":return"â˜½";default:return"âš™"}},Te=e.jsxs("nav",{className:"mobile-bottom-nav",ref:I,children:[e.jsxs("button",{className:`bottom-nav-item ${u==="canvas"?"active":""}`,onClick:()=>ee("canvas"),children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:e.jsx("path",{fill:"currentColor",d:"M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM5 15h14v3H5z"})}),e.jsx("span",{children:"Canvas"})]}),e.jsxs("button",{className:`bottom-nav-item ${u==="guests"?"active":""}`,onClick:()=>ee("guests"),children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:e.jsx("path",{fill:"currentColor",d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})}),e.jsx("span",{children:"Guests"})]}),e.jsxs("button",{className:"bottom-nav-item add-btn",onClick:()=>w(!0),children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"28",height:"28",children:e.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),e.jsx("span",{children:"Add"})]}),e.jsxs("button",{className:`bottom-nav-item ${S?"active":""}`,onClick:()=>w(!S),children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:e.jsx("path",{fill:"currentColor",d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})}),e.jsx("span",{children:"More"})]})]}),ae=S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mobile-menu-backdrop",onClick:v=>{v.target===v.currentTarget&&w(!1)}}),e.jsxs("div",{className:`mobile-menu-sheet ${u==="canvas"?"canvas-view":""}`,role:"menu",ref:M,onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"menu-section",children:[e.jsx("div",{className:"menu-section-label",children:"View"}),e.jsxs("div",{className:"menu-view-buttons",children:[e.jsxs("button",{className:`menu-view-btn ${u==="dashboard"?"active":""}`,onClick:()=>V("dashboard"),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ“Š"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("button",{className:`menu-view-btn ${u==="canvas"?"active":""}`,onClick:()=>V("canvas"),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸŽ¨"}),e.jsx("span",{children:"Canvas"})]}),e.jsxs("button",{className:`menu-view-btn ${u==="guests"?"active":""}`,onClick:()=>V("guests"),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ“‹"}),e.jsx("span",{children:"Guest List"})]})]})]}),e.jsxs("div",{className:"menu-section",children:[e.jsx("div",{className:"menu-section-label",children:"Actions"}),u==="canvas"&&e.jsx("div",{className:"menu-item-group",children:P?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"menu-item back",onClick:()=>z(!1),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"â†"}),e.jsx("span",{children:"Back"})]}),e.jsxs("button",{className:"menu-item",onClick:()=>se("round"),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"â­•"}),e.jsx("span",{children:"Round Table"})]}),e.jsxs("button",{className:"menu-item",onClick:()=>se("rectangle"),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"â–­"}),e.jsx("span",{children:"Rectangle Table"})]})]}):e.jsxs("button",{className:"menu-item",onClick:()=>z(!0),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸª‘"}),e.jsx("span",{children:"Add Table"}),e.jsx("span",{className:"menu-chevron",children:"â€º"})]})}),e.jsxs("button",{className:"menu-item",onClick:xe,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ‘¤"}),e.jsx("span",{children:"Add Guest"})]}),a&&e.jsxs("button",{className:"menu-item",onClick:fe,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ“¥"}),e.jsx("span",{children:"Import Guests"})]}),u==="canvas"&&(ge?e.jsxs("button",{className:"menu-item",onClick:Ne,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"â†©ï¸"}),e.jsx("span",{children:"Reset Seating"})]}):e.jsxs("button",{className:"menu-item",onClick:be,disabled:!pe,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"âœ¨"}),e.jsx("span",{children:"Optimize Seating"})]}))]}),u==="canvas"&&e.jsxs("div",{className:"menu-section",children:[e.jsx("div",{className:"menu-section-label",children:"Canvas Tools"}),e.jsxs("div",{className:"menu-zoom-controls",children:[e.jsx("button",{className:"menu-zoom-btn",onClick:()=>A(Math.max(.25,E.zoom-.25)),"aria-label":"Zoom out",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M19 13H5v-2h14v2z"})})}),e.jsxs("span",{className:"menu-zoom-value",children:[Math.round(E.zoom*100),"%"]}),e.jsx("button",{className:"menu-zoom-btn",onClick:()=>A(Math.min(2,E.zoom+.25)),"aria-label":"Zoom in",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})}),e.jsx("button",{className:"menu-zoom-btn reset",onClick:()=>R(window.innerWidth,window.innerHeight),"aria-label":"Reset view",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})})]}),l&&e.jsxs("button",{className:`menu-item toggle ${i?"active":""}`,onClick:ve,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M20 3H4c-.55 0-1 .45-1 1v16c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM9 19H5v-4h4v4zm0-6H5V9h4v4zm0-6H5V5h4v2zm6 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2zm4 12h-4v-4h4v4zm0-6h-4V9h4v4zm0-6h-4V5h4v2z"})})}),e.jsx("span",{children:"Grid Controls"}),i&&e.jsx("span",{className:"checkmark",children:"âœ“"})]}),t&&e.jsxs("button",{className:`menu-item toggle ${n?"active":""}`,onClick:je,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ”—"}),e.jsx("span",{children:"Show Relationships"}),n&&e.jsx("span",{className:"checkmark",children:"âœ“"})]})]}),e.jsxs("div",{className:"menu-section",children:[e.jsx("div",{className:"menu-section-label",children:"Settings"}),e.jsxs("div",{className:"menu-item static",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ“¦"}),e.jsxs("span",{children:["Version ",Ae]})]}),e.jsx("div",{className:"menu-item-updates",children:e.jsx(_e,{variant:"mobile-menu"})}),g&&m&&e.jsxs("button",{className:"menu-item",onClick:we,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸ“§"}),e.jsx("span",{children:"Subscribe for Updates"})]}),d&&e.jsxs("button",{className:"menu-item",onClick:ye,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"âŒ¨ï¸"}),e.jsx("span",{children:"Keyboard Shortcuts"})]}),e.jsxs("button",{className:"menu-item",onClick:Ee,role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:Ce()}),e.jsxs("span",{children:["Theme: ",Se()]})]})]}),h&&e.jsxs("div",{className:"menu-section",children:[e.jsx("div",{className:"menu-section-label",children:"Learn"}),$?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"menu-item back",onClick:()=>j(!1),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"â†"}),e.jsx("span",{children:"Back"})]}),L.map(v=>e.jsxs("button",{className:`menu-item tour-item ${T(v.id)?"completed":""}`,onClick:()=>ne(v.id),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:v.icon}),e.jsxs("span",{className:"tour-info",children:[e.jsx("span",{className:"tour-title",children:v.title}),e.jsx("span",{className:"tour-time",children:v.estimatedTime})]}),T(v.id)&&e.jsx("span",{className:"checkmark",children:"âœ“"})]},v.id)),G.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"menu-section-sublabel",children:"Feature Tours"}),G.map(v=>e.jsxs("button",{className:`menu-item tour-item ${T(v.id)?"completed":""}`,onClick:()=>ne(v.id),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:v.icon}),e.jsxs("span",{className:"tour-info",children:[e.jsx("span",{className:"tour-title",children:v.title}),e.jsx("span",{className:"tour-time",children:v.estimatedTime})]}),T(v.id)&&e.jsx("span",{className:"checkmark",children:"âœ“"})]},v.id))]})]}):e.jsxs("button",{className:"menu-item",onClick:()=>j(!0),role:"menuitem",children:[e.jsx("span",{className:"menu-icon",children:"ðŸŽ“"}),e.jsx("span",{children:"Browse Tours"}),e.jsx("span",{className:"menu-chevron",children:"â€º"})]})]}),e.jsxs("div",{className:"menu-footer",children:[e.jsx("span",{className:"event-name",children:p.name||"Untitled Event"}),e.jsxs("span",{className:"guest-count",children:[p.guests.length," guests"]})]})]})]});return e.jsxs("div",{className:"mobile-toolbar-menu",children:[e.jsx("button",{className:`hamburger-btn ${S?"active":""}`,onClick:()=>w(!S),"aria-label":"Menu","aria-expanded":S,children:e.jsxs("span",{className:"hamburger-icon",children:[e.jsx("span",{className:"hamburger-line"}),e.jsx("span",{className:"hamburger-line"}),e.jsx("span",{className:"hamburger-line"})]})}),u!=="canvas"&&J.createPortal(Te,document.body),ae&&J.createPortal(ae,document.body)]})}function Fe({onShowHelp:s,onStartTour:a,showRelationships:n,onToggleRelationships:t,children:i}){const l=Q(),{event:d,setEventName:h,theme:m,cycleTheme:g,canvas:p,setZoom:c,recenterCanvas:u}=O(),[r,o]=f.useState(!1),[x,b]=f.useState(!1),E=f.useRef(null),A=f.useRef(null);f.useEffect(()=>{r&&E.current&&(E.current.focus(),E.current.select())},[r]),f.useEffect(()=>{const S=w=>{A.current&&!A.current.contains(w.target)&&b(!1)};if(x)return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[x]),f.useEffect(()=>{const S=w=>{w.key==="Escape"&&(b(!1),o(!1))};return document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)},[]);const R=()=>{l("/events")},N=()=>{o(!0)},y=()=>{o(!1)},C=S=>{S.key==="Enter"&&o(!1)},T=()=>{switch(m){case"light":return"â˜€";case"dark":return"â˜½";default:return"âš™"}},k=()=>{switch(m){case"light":return"Light";case"dark":return"Dark";default:return"System"}};return e.jsxs("div",{className:"mobile-canvas-toolbar",children:[e.jsx("button",{className:"mobile-canvas-back",onClick:R,"aria-label":"Back to events",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})})}),e.jsx("div",{className:"mobile-canvas-title",children:r?e.jsx("input",{ref:E,type:"text",value:d.name,onChange:S=>h(S.target.value),onBlur:y,onKeyDown:C,className:"mobile-canvas-name-input"}):e.jsxs("button",{className:"mobile-canvas-name",onClick:N,"aria-label":"Edit event name",children:[d.name||"Untitled Event",e.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",className:"edit-icon",children:e.jsx("path",{fill:"currentColor",d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})]})}),i&&e.jsx("div",{className:"mobile-canvas-controls",children:i}),e.jsxs("div",{className:"mobile-canvas-settings-container",ref:A,children:[e.jsx("button",{className:`mobile-canvas-settings ${x?"active":""}`,onClick:()=>b(!x),"aria-label":"Settings","aria-expanded":x,children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{fill:"currentColor",d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})})}),x&&e.jsxs("div",{className:"mobile-canvas-settings-sheet",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-label",children:"Zoom"}),e.jsxs("div",{className:"settings-zoom-controls",children:[e.jsx("button",{className:"zoom-btn",onClick:()=>c(Math.max(.25,p.zoom-.25)),"aria-label":"Zoom out",children:"âˆ’"}),e.jsxs("span",{className:"zoom-value",children:[Math.round(p.zoom*100),"%"]}),e.jsx("button",{className:"zoom-btn",onClick:()=>c(Math.min(2,p.zoom+.25)),"aria-label":"Zoom in",children:"+"}),e.jsx("button",{className:"zoom-btn reset",onClick:()=>u(window.innerWidth,window.innerHeight),"aria-label":"Reset view",children:"âŸ²"})]})]}),e.jsx("div",{className:"settings-section",children:t&&e.jsxs("button",{className:`settings-item ${n?"active":""}`,onClick:()=>{t()},children:[e.jsx("span",{className:"settings-icon",children:"ðŸ”—"}),e.jsx("span",{children:"Relationships"}),n&&e.jsx("span",{className:"checkmark",children:"âœ“"})]})}),e.jsx("div",{className:"settings-section",children:e.jsxs("button",{className:"settings-item",onClick:g,children:[e.jsx("span",{className:"settings-icon",children:T()}),e.jsxs("span",{children:["Theme: ",k()]})]})}),e.jsxs("div",{className:"settings-section",children:[s&&e.jsxs("button",{className:"settings-item",onClick:()=>{s(),b(!1)},children:[e.jsx("span",{className:"settings-icon",children:"âŒ¨ï¸"}),e.jsx("span",{children:"Shortcuts"})]}),a&&e.jsxs("button",{className:"settings-item",onClick:()=>{a("quick-start"),b(!1)},children:[e.jsx("span",{className:"settings-icon",children:"ðŸŽ“"}),e.jsx("span",{children:"Take Tour"})]})]}),e.jsx("div",{className:"settings-section",children:e.jsxs("button",{className:"settings-item guests-btn",onClick:()=>{l(`/events/${d.id}/guests`),b(!1)},children:[e.jsx("span",{className:"settings-icon",children:"ðŸ‘¥"}),e.jsx("span",{children:"Guest List"}),e.jsx("span",{className:"guest-count",children:d.guests.length})]})})]})]})]})}function As({children:s,onAddGuest:a,onImport:n,showRelationships:t,onToggleRelationships:i,onShowHelp:l,onStartTour:d,onSubscribe:h,canShowEmailButton:m}){const{event:g,addTable:p,addGuest:c,activeView:u,optimizeSeating:r,resetSeating:o,hasOptimizationSnapshot:x}=O(),b=$e(),[E,A]=f.useState(!1),[R,N]=f.useState(!1),y=f.useRef(null),C=g.guests.some(j=>j.relationships.length>0),T=g.tables.some(j=>j.capacity>0),k=C&&T&&g.guests.length>1,S=x();console.log("Optimization state:",{hasRelationships:C,hasTablesWithCapacity:T,guestCount:g.guests.length,canOptimize:k,hasSnapshot:S,guestsWithRelationships:g.guests.filter(j=>j.relationships.length>0).map(j=>({name:_(j),relCount:j.relationships.length}))});const w=()=>{N(!0),setTimeout(()=>{const j=r();N(!1);const I=j.movedGuests.length>0?` Â· ${j.movedGuests.length} guest${j.movedGuests.length!==1?"s":""} moved`:"";K(`Seating Optimized! Score: ${j.beforeScore} â†’ ${j.afterScore}${I}`,"success")},300)},P=()=>{o()};f.useEffect(()=>{const j=I=>{y.current&&!y.current.contains(I.target)&&A(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const z=j=>{const I=g.tables.length+1,M=400+I*50%200,L=300+I*30%150;p(j,M,L),A(!1)},$=()=>{if(a)a();else{const j=g.guests.length+1;c({firstName:"Guest",lastName:`${j}`,group:void 0})}};return b?u==="canvas"?e.jsx(Fe,{onShowHelp:l,onStartTour:d,showRelationships:t,onToggleRelationships:i,children:s}):e.jsxs("div",{className:"main-toolbar mobile",children:[e.jsx(Ge,{onAddGuest:$,onImport:n,showRelationships:t,onToggleRelationships:i,onShowHelp:l,onStartTour:d,onSubscribe:h,canShowEmailButton:m}),e.jsx("div",{className:"toolbar-section toolbar-middle mobile-middle",children:s})]}):e.jsxs("div",{className:"main-toolbar",children:[e.jsxs("div",{className:"toolbar-section toolbar-left",children:[u==="canvas"&&e.jsxs("div",{className:"add-dropdown",ref:y,children:[e.jsxs("button",{onClick:()=>A(!E),className:"toolbar-btn primary",title:"Add Table",children:[e.jsx("span",{className:"btn-icon",children:"ðŸª‘"}),!b&&e.jsx("span",{className:"btn-text",children:"Add Table"})]}),E&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("button",{onClick:()=>z("round"),children:[e.jsx("span",{className:"table-shape-icon",children:"â­•"})," Round Table"]}),e.jsxs("button",{onClick:()=>z("rectangle"),children:[e.jsx("span",{className:"table-shape-icon",children:"â–­"})," Rectangle Table"]})]})]}),e.jsxs("button",{onClick:$,className:"toolbar-btn primary",title:"Add Guest",children:[e.jsx("span",{className:"btn-icon",children:"ðŸ‘¤"}),!b&&e.jsx("span",{className:"btn-text",children:"Add Guest"})]}),n&&e.jsxs("button",{onClick:n,className:"toolbar-btn secondary",title:"Import guests from CSV or Excel",children:[e.jsx("span",{className:"btn-icon",children:"ðŸ“¥"}),!b&&e.jsx("span",{className:"btn-text",children:"Import"})]}),u==="canvas"&&(S?e.jsxs("button",{onClick:P,className:"toolbar-btn reset",title:"Reset to original seating arrangement",children:[e.jsx("span",{className:"btn-icon",children:"â†©ï¸"}),!b&&e.jsx("span",{className:"btn-text",children:"Reset"})]}):e.jsxs("button",{onClick:w,className:`toolbar-btn optimize ${R?"optimizing":""}`,disabled:!k||R,title:k?"Optimize seating based on relationships":"Add guest relationships to enable optimization",children:[e.jsx("span",{className:"btn-icon",children:"âœ¨"}),!b&&e.jsx("span",{className:"btn-text",children:R?"Optimizing...":"Optimize"})]}))]}),e.jsx("div",{className:"toolbar-section toolbar-middle",children:s}),e.jsx("div",{className:"toolbar-section toolbar-right",children:e.jsx(Pe,{showRelationships:t,onToggleRelationships:i})})]})}const H=[{value:null,label:"None",short:"-",color:"transparent"},{value:"partner",label:"Partner",short:"P",color:"#e91e63"},{value:"family",label:"Family",short:"F",color:"#9c27b0"},{value:"friend",label:"Friend",short:"+",color:"#2196f3"},{value:"colleague",label:"Colleague",short:"C",color:"#4caf50"},{value:"avoid",label:"Avoid",short:"X",color:"#f44336"}],Oe=s=>{switch(s){case"partner":return 5;case"family":return 4;case"friend":return 3;case"colleague":return 2;case"avoid":return 5;default:return 3}};function _s(){const{event:s,addRelationship:a,removeRelationship:n}=O(),[t,i]=f.useState(null),l=s.guests.filter(r=>r.rsvpStatus!=="declined"),d=f.useMemo(()=>{const r=new Map;return[...s.tables].sort((x,b)=>x.name.localeCompare(b.name)).forEach((x,b)=>r.set(x.id,b)),[...l].sort((x,b)=>{const E=x.tableId?r.get(x.tableId)??999:1e3,A=b.tableId?r.get(b.tableId)??999:1e3;return E!==A?E-A:_(x).localeCompare(_(b))})},[l,s.tables]),h=f.useMemo(()=>{const r=new Set;let o;return d.forEach((x,b)=>{b>0&&x.tableId!==o&&r.add(b),o=x.tableId}),r},[d]),m=r=>r&&s.tables.find(o=>o.id===r)?.name||null,g=(r,o)=>s.guests.find(b=>b.id===r)?.relationships?.find(b=>b.guestId===o),p=(r,o,x)=>{if(x===null)n(r,o),n(o,r);else{const b=Oe(x);a(r,o,x,b),a(o,r,x,b)}i(null)},c=r=>r.split(" ").map(o=>o[0]).join("").slice(0,2).toUpperCase(),u=(r,o)=>{r!==o&&i({from:r,to:o})};return e.jsxs("div",{className:"relationship-matrix",children:[e.jsx("div",{className:"matrix-controls",children:e.jsx("div",{className:"legend",children:H.filter(r=>r.value).map(r=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-color",style:{backgroundColor:r.color},children:r.short}),r.label]},r.value))})}),e.jsx("div",{className:"matrix-scroll",children:e.jsxs("div",{className:"matrix-grid",children:[e.jsxs("div",{className:"matrix-header",children:[e.jsx("div",{className:"matrix-corner"}),d.map((r,o)=>{const x=m(r.tableId),b=h.has(o);return e.jsx("div",{className:`matrix-col-header ${b?"table-boundary":""}`,title:`${_(r)}${x?` (${x})`:" (Unassigned)"}`,children:c(_(r))},r.id)})]}),d.map((r,o)=>{const x=m(r.tableId),b=h.has(o);return e.jsxs("div",{className:`matrix-row ${b?"table-boundary":""}`,children:[e.jsxs("div",{className:"matrix-row-header",title:`${_(r)}${x?` (${x})`:" (Unassigned)"}`,children:[e.jsx("span",{className:"row-name",children:_(r)}),x&&e.jsx("span",{className:"row-table",children:x})]}),d.map((E,A)=>{const R=g(r.id,E.id),N=H.find(S=>S.value===R?.type),y=r.id===E.id,C=t?.from===r.id&&t?.to===E.id,T=r.tableId&&r.tableId===E.tableId,k=h.has(A);return e.jsx("div",{className:`matrix-cell ${y?"disabled":""} ${C?"selected":""} ${T?"same-table":""} ${k?"col-boundary":""}`,style:{backgroundColor:N?.color||"transparent"},onClick:()=>u(r.id,E.id),title:y?"":`${_(r)} â†’ ${_(E)}`,children:y?"â€”":N?.short||""},`${r.id}-${E.id}`)})]},r.id)})]})}),t&&e.jsx("div",{className:"cell-dropdown-overlay",onClick:()=>i(null),children:e.jsxs("div",{className:"cell-dropdown",onClick:r=>r.stopPropagation(),children:[e.jsxs("h4",{children:[_(s.guests.find(r=>r.id===t.from))," â†” ",_(s.guests.find(r=>r.id===t.to))]}),e.jsx("div",{className:"dropdown-options",children:H.map(r=>e.jsxs("button",{className:"dropdown-option",style:{borderLeftColor:r.color},onClick:()=>p(t.from,t.to,r.value),children:[e.jsx("span",{className:"option-indicator",style:{backgroundColor:r.color},children:r.short}),r.label]},r.value||"none"))})]})}),l.length===0&&e.jsxs("div",{className:"matrix-empty",children:[e.jsx("p",{children:"No confirmed guests yet."}),e.jsx("p",{children:"Add guests to start managing relationships."})]})]})}const X={file:null,parsedFile:null,detectedEventType:null,detectedPlatform:null,fileError:null,columnMappings:[],parsedGuests:[],validationErrors:[],excludedRowIndices:new Set,tableAssignment:{enabled:!1,tableShape:"round",tableCapacity:8,tableCount:0,distributionStrategy:"even"},tableAssignmentPreview:new Map,duplicates:[],duplicateResolutions:new Map,isImporting:!1,importError:null};function De(s,a){switch(a.type){case"SET_FILE":return{...s,file:a.payload.file,parsedFile:a.payload.parsedFile,fileError:null};case"SET_FILE_ERROR":return{...s,fileError:a.payload};case"CLEAR_FILE":return{...X};case"SET_DETECTED_EVENT_TYPE":return{...s,detectedEventType:a.payload};case"SET_DETECTED_PLATFORM":return{...s,detectedPlatform:a.payload};case"SET_COLUMN_MAPPINGS":return{...s,columnMappings:a.payload};case"UPDATE_COLUMN_MAPPING":return{...s,columnMappings:s.columnMappings.map((n,t)=>t===a.payload.index?{...n,...a.payload.mapping}:n)};case"SET_PARSED_GUESTS":return{...s,parsedGuests:a.payload};case"SET_VALIDATION_ERRORS":return{...s,validationErrors:a.payload};case"TOGGLE_EXCLUDE_ROW":{const n=new Set(s.excludedRowIndices);return n.has(a.payload)?n.delete(a.payload):n.add(a.payload),{...s,excludedRowIndices:n}}case"SET_TABLE_ASSIGNMENT_ENABLED":return{...s,tableAssignment:{...s.tableAssignment,enabled:a.payload}};case"SET_TABLE_SHAPE":{const n=B[a.payload];return{...s,tableAssignment:{...s.tableAssignment,tableShape:a.payload,tableCapacity:n.capacity}}}case"SET_TABLE_CAPACITY":return{...s,tableAssignment:{...s.tableAssignment,tableCapacity:a.payload}};case"SET_TABLE_COUNT":return{...s,tableAssignment:{...s.tableAssignment,tableCount:a.payload}};case"SET_DISTRIBUTION_STRATEGY":return{...s,tableAssignment:{...s.tableAssignment,distributionStrategy:a.payload}};case"SET_TABLE_ASSIGNMENT_PREVIEW":return{...s,tableAssignmentPreview:a.payload};case"SET_DUPLICATES":return{...s,duplicates:a.payload};case"SET_DUPLICATE_RESOLUTION":{const n=new Map(s.duplicateResolutions);return n.set(a.payload.index,a.payload.resolution),{...s,duplicateResolutions:n}}case"SET_ALL_DUPLICATE_RESOLUTIONS":{const n=new Map;return s.duplicates.forEach((t,i)=>n.set(i,a.payload)),{...s,duplicateResolutions:n}}case"SET_IMPORTING":return{...s,isImporting:a.payload};case"SET_IMPORT_ERROR":return{...s,importError:a.payload};case"RESET":return X;default:return s}}const Be={firstName:"First Name",lastName:"Last Name",fullName:"Full Name (will split)",email:"Email",company:"Company",jobTitle:"Job Title",industry:"Industry",interests:"Interests",dietaryRestrictions:"Dietary Restrictions",accessibilityNeeds:"Accessibility Needs",group:"Group",rsvpStatus:"RSVP Status",notes:"Notes"},B={round:{capacity:8,width:120,height:120},rectangle:{capacity:10,width:200,height:80},square:{capacity:8,width:100,height:100},oval:{capacity:10,width:180,height:120},"half-round":{capacity:5,width:160,height:80},serpentine:{capacity:12,width:300,height:100}},ie={round:"Round",rectangle:"Rectangle",square:"Square",oval:"Oval","half-round":"Half-Round",serpentine:"Serpentine"},Y={even:{label:"Distribute Evenly",description:"Spread guests uniformly across all tables"},groups:{label:"Keep Groups Together",description:"Seat guests with the same group at the same table when possible"},optimized:{label:"Smart Optimization",description:"Use relationship data (partners, friends, avoid) to optimize seating"},skip:{label:"Don't Assign",description:"Create tables but leave all guests unassigned"}};var Ue=Me();const Ve=Re(Ue),le=5*1024*1024,re=1e4;async function We(s){if(s.size>le)return{success:!1,error:`File exceeds ${le/1024/1024}MB limit. Please use a smaller file.`};const a=s.name.split(".").pop()?.toLowerCase();try{let n;if(a==="csv")n=await He(s);else if(a==="xlsx"||a==="xls")n=await Ye(s);else return{success:!1,error:"Unsupported file format. Please upload a CSV or Excel file (.csv, .xlsx, .xls)."};return n.rowCount>re?{success:!1,error:`File contains ${n.rowCount} rows, which exceeds the ${re} row limit.`}:n.headers.length===0?{success:!1,error:"The file appears to be empty or has no headers."}:n.rows.length===0?{success:!1,error:"The file has headers but no data rows."}:{success:!0,data:n}}catch(n){return{success:!1,error:`Unable to read file: ${n instanceof Error?n.message:"Unknown error"}`}}}async function He(s){return new Promise((a,n)=>{Ve.parse(s,{complete:t=>{const l=t.data.filter(m=>m.some(g=>g&&g.trim()!==""));if(l.length===0){n(new Error("File is empty"));return}const d=l[0].map(m=>(m||"").trim()),h=l.slice(1).map(m=>m.map(g=>(g||"").trim()));a({headers:d,rows:h,rowCount:h.length,fileName:s.name,fileSize:s.size})},error:t=>{n(new Error(t.message))}})})}async function Ye(s){return new Promise((a,n)=>{const t=new FileReader;t.onload=i=>{try{const l=i.target?.result,d=Le(l,{type:"array"}),h=d.SheetNames[0];if(!h){n(new Error("Excel file has no sheets"));return}const m=d.Sheets[h],p=ze.sheet_to_json(m,{header:1,defval:""}).filter(r=>r.some(o=>o&&String(o).trim()!==""));if(p.length===0){n(new Error("Sheet is empty"));return}const c=p[0].map(r=>String(r||"").trim()),u=p.slice(1).map(r=>r.map(o=>String(o||"").trim()));a({headers:c,rows:u,rowCount:u.length,fileName:s.name,fileSize:s.size})}catch(l){n(l)}},t.onerror=()=>{n(new Error("Failed to read file"))},t.readAsArrayBuffer(s)})}function Ze(s){return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`}const qe={firstName:[/^first[_\s-]?name$/i,/^fname$/i,/^given[_\s-]?name$/i,/^first$/i,/^forename$/i],lastName:[/^last[_\s-]?name$/i,/^lname$/i,/^surname$/i,/^family[_\s-]?name$/i,/^last$/i],fullName:[/^(full[_\s-]?)?name$/i,/^guest[_\s-]?name$/i,/^attendee[_\s-]?name$/i],email:[/^e[_\s-]?mail$/i,/^email[_\s-]?address$/i],company:[/^company$/i,/^organization$/i,/^org$/i,/^employer$/i,/^firm$/i,/^business$/i],jobTitle:[/^(job[_\s-]?)?title$/i,/^position$/i,/^role$/i,/^designation$/i],industry:[/^industry$/i,/^sector$/i,/^field$/i],interests:[/^interests?$/i,/^hobbies?$/i],dietaryRestrictions:[/^diet(ary)?$/i,/^meal[_\s-]?(choice|preference|type)?$/i,/^food[_\s-]?(restriction|allergy|preference)?$/i,/^allergies?$/i,/^dietary[_\s-]?(restrictions?|requirements?|needs?)?$/i],accessibilityNeeds:[/^accessibility$/i,/^access[_\s-]?needs?$/i,/^special[_\s-]?needs?$/i,/^accommodations?$/i],group:[/^group$/i,/^party$/i,/^team$/i,/^category$/i],rsvpStatus:[/^rsvp$/i,/^status$/i,/^attending$/i,/^response$/i,/^confirmed?$/i],notes:[/^notes?$/i,/^comments?$/i,/^remarks?$/i,/^special[_\s-]?requests?$/i,/^additional[_\s-]?info$/i]},Ke={group:[/^guest[_\s-]?of$/i,/^(bride|groom)('?s)?[_\s-]?(side|family|guest)?$/i,/^side$/i,/^party$/i,/^table[_\s-]?group$/i]},Je={group:[/^department$/i,/^team$/i,/^division$/i,/^unit$/i]},Xe={firstName:[/^first[_\s-]?name$/i],lastName:[/^last[_\s-]?name$/i],email:[/^email[_\s-]?address$/i],group:[/^group[_\s-]?id$/i,/^tags$/i],notes:[/^title$/i]},Qe={fullName:[/^name$/i],email:[/^email[_\s-]?address$/i]},es={firstName:[/^first[_\s-]?name$/i],lastName:[/^last[_\s-]?name$/i],email:[/^email[_\s-]?address$/i],group:[/^party$/i,/^tags$/i],notes:[/^name[_\s-]?on[_\s-]?envelope$/i]};function ss(s){const a=s.join(" ").toLowerCase(),t=[/bride/i,/groom/i,/wedding/i,/party/i,/guest[_\s-]?of/i,/side/i,/ceremony/i,/reception/i].reduce((m,g)=>m+(g.test(a)?1:0),0),l=[/company/i,/department/i,/title/i,/role/i,/organization/i,/team/i,/division/i].reduce((m,g)=>m+(g.test(a)?1:0),0),h=[/gala/i,/charity/i,/fundraiser/i,/benefit/i,/auction/i].reduce((m,g)=>m+(g.test(a)?1:0),0);return t>l&&t>h&&t>=1?"wedding":l>t&&l>h&&l>=2?"corporate":h>t&&h>l&&h>=1?"gala":"party"}function ns(s){const a=new Set(s.map(i=>i.toLowerCase().trim())),n=[...a];if(a.has("group id"))return{platform:"rsvpify",confidence:"high"};const t=n.some(i=>/^additional\s*guest\s*\d+$/i.test(i));return a.has("name")&&!a.has("first name")&&!a.has("last name")&&(a.has("plus one")||t)?{platform:"zola",confidence:"high"}:a.has("party")&&a.has("tags")||n.some(i=>/^name\s*on\s*envelope$/i.test(i))?{platform:"joy",confidence:"medium",note:"Joy format detected. Some columns may need manual mapping."}:{platform:"generic",confidence:"low"}}function ce(s){switch(s){case"rsvpify":return Xe;case"zola":return Qe;case"joy":return es;default:return{}}}const as={rsvpify:"RSVPify",zola:"Zola",joy:"Joy",generic:"Unknown"};function ts(s,a,n,t){const i={...qe},l=d=>{Object.entries(d).forEach(([h,m])=>{m&&(i[h]=[...m,...i[h]])})};return t&&t!=="generic"&&l(ce(t)),n==="wedding"?l(Ke):n==="corporate"&&l(Je),s.map((d,h)=>{const m=d.trim(),g=a.slice(0,3).map(c=>c[h]||"");let p=null;for(const[c,u]of Object.entries(i))for(const r of u)if(r.test(m)){let o=r.source.startsWith("^")?.95:.7;t&&t!=="generic"&&ce(t)[c]?.some(E=>E.source===r.source)&&(o=Math.min(o+.03,.98)),(!p||o>p.confidence)&&(p={field:c,confidence:o})}return!p&&/name/i.test(m)&&(p={field:"fullName",confidence:.5}),{sourceColumn:m,targetField:p?.field??null,confidence:p?.confidence??0,sampleValues:g}})}function is(s){const a=new Set(s.map(l=>l.targetField).filter(Boolean)),n=a.has("firstName"),t=a.has("lastName"),i=a.has("fullName");return n&&t||i}function ls(s){const a=new Set(s.map(d=>d.targetField).filter(Boolean)),n=a.has("firstName"),t=a.has("lastName"),i=a.has("fullName");if(i||n&&t)return[];const l=[];return!n&&!i&&l.push("First Name"),!t&&!i&&l.push("Last Name"),l}function rs(s){const a=s.trim().split(/\s+/);return a.length===0?{firstName:"",lastName:""}:a.length===1?{firstName:a[0],lastName:""}:{firstName:a[0],lastName:a.slice(1).join(" ")}}function cs({state:s,dispatch:a}){const[n,t]=f.useState(!1),i=f.useCallback(async p=>{const c=await We(p);if(!c.success){a({type:"SET_FILE_ERROR",payload:c.error});return}a({type:"SET_FILE",payload:{file:p,parsedFile:c.data}});const u=ns(c.data.headers);a({type:"SET_DETECTED_PLATFORM",payload:u});const r=ss(c.data.headers);a({type:"SET_DETECTED_EVENT_TYPE",payload:r});const o=ts(c.data.headers,c.data.rows,r,u.platform);a({type:"SET_COLUMN_MAPPINGS",payload:o})},[a]),l=f.useCallback(p=>{p.preventDefault(),t(!1);const c=p.dataTransfer.files[0];c&&i(c)},[i]),d=f.useCallback(p=>{p.preventDefault(),t(!0)},[]),h=f.useCallback(p=>{p.preventDefault(),t(!1)},[]),m=f.useCallback(p=>{const c=p.target.files?.[0];c&&i(c)},[i]),g=f.useCallback(()=>{a({type:"CLEAR_FILE"})},[a]);return e.jsxs("div",{className:"file-upload-step",children:[e.jsxs("div",{className:"step-description",children:[e.jsx("p",{children:"Upload a CSV or Excel file containing your guest list."}),e.jsx("p",{className:"hint",children:"Supported formats: .csv, .xlsx, .xls (max 5MB, 10,000 rows)"}),e.jsxs("p",{className:"hint platforms-hint",children:["Works with exports from ",e.jsx("strong",{children:"Zola"}),", ",e.jsx("strong",{children:"RSVPify"}),", ",e.jsx("strong",{children:"Joy"}),", and CSV/Excel."," ",e.jsx("span",{className:"coming-soon-platforms",children:"The Knot, Eventbrite coming soon."})]})]}),s.parsedFile?e.jsxs("div",{className:"file-info",children:[e.jsx("div",{className:"file-icon",children:e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})}),e.jsxs("div",{className:"file-details",children:[e.jsx("p",{className:"file-name",children:s.parsedFile.fileName}),e.jsxs("p",{className:"file-meta",children:[Ze(s.parsedFile.fileSize)," â€¢ ",s.parsedFile.rowCount," rows â€¢"," ",s.parsedFile.headers.length," columns"]}),s.detectedEventType&&e.jsxs("p",{className:"event-type-hint",children:["Detected event type: ",e.jsx("strong",{children:s.detectedEventType})]}),s.detectedPlatform&&s.detectedPlatform.platform!=="generic"&&e.jsxs("p",{className:"platform-hint",children:["Source detected:"," ",e.jsx("strong",{children:as[s.detectedPlatform.platform]}),s.detectedPlatform.confidence!=="high"&&e.jsxs("span",{className:"confidence-indicator",title:`${s.detectedPlatform.confidence} confidence`,children:[" ","(",s.detectedPlatform.confidence,")"]})]}),s.detectedPlatform?.note&&e.jsxs("p",{className:"platform-note",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),s.detectedPlatform.note]}),s.detectedPlatform?.platform==="generic"&&e.jsxs("p",{className:"help-improve-hint",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})]}),"Exported from The Knot, Eventbrite, or another platform?"," ",e.jsx("a",{href:"https://github.com/anthropics/claude-code/issues",target:"_blank",rel:"noopener noreferrer",className:"help-improve-link",children:"Help us improve detection"})]})]}),e.jsx("button",{className:"btn-icon clear-file",onClick:g,"aria-label":"Remove file",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):e.jsx("div",{className:`drop-zone ${n?"dragging":""} ${s.fileError?"error":""}`,onDrop:l,onDragOver:d,onDragLeave:h,children:e.jsxs("div",{className:"drop-zone-content",children:[e.jsx("div",{className:"drop-icon",children:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),e.jsx("p",{className:"drop-text",children:"Drag and drop your file here"}),e.jsx("p",{className:"drop-or",children:"or"}),e.jsxs("label",{className:"file-input-label",children:[e.jsx("span",{className:"btn-secondary",children:"Browse Files"}),e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:m,className:"file-input"})]})]})}),s.fileError&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),s.fileError]})]})}const os=[null,"firstName","lastName","fullName","email","company","jobTitle","industry","group","dietaryRestrictions","accessibilityNeeds","rsvpStatus","notes"];function ds({state:s,dispatch:a}){const n=ls(s.columnMappings);f.useEffect(()=>{if(!s.parsedFile)return;const l=ms(s.parsedFile.rows,s.columnMappings);a({type:"SET_PARSED_GUESTS",payload:l});const d=hs(l);a({type:"SET_VALIDATION_ERRORS",payload:d})},[s.columnMappings,s.parsedFile,a]);const t=f.useCallback((l,d)=>{a({type:"UPDATE_COLUMN_MAPPING",payload:{index:l,mapping:{targetField:d,confidence:d?1:0}}})},[a]),i=l=>l>=.9?"high":l>=.7?"medium":"low";return e.jsxs("div",{className:"column-mapping-step",children:[e.jsxs("div",{className:"step-description",children:[e.jsx("p",{children:"Map your file columns to guest fields. We've auto-detected some mappings for you."}),n.length>0&&e.jsxs("p",{className:"warning",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),"Missing required: ",n.join(", ")]})]}),e.jsxs("div",{className:"mapping-table",children:[e.jsxs("div",{className:"mapping-header",children:[e.jsx("span",{className:"col-source",children:"File Column"}),e.jsx("span",{className:"col-sample",children:"Sample Values"}),e.jsx("span",{className:"col-target",children:"Map To"})]}),s.columnMappings.map((l,d)=>e.jsxs("div",{className:"mapping-row",children:[e.jsxs("div",{className:"col-source",children:[e.jsx("span",{className:"column-name",children:l.sourceColumn}),l.confidence>0&&e.jsx("span",{className:`confidence-badge ${i(l.confidence)}`,title:`${Math.round(l.confidence*100)}% confidence`,children:l.confidence>=.9?"âœ“":"?"})]}),e.jsx("div",{className:"col-sample",children:l.sampleValues.slice(0,2).map((h,m)=>e.jsx("span",{className:"sample-value",children:h||e.jsx("em",{className:"empty",children:"empty"})},m))}),e.jsx("div",{className:"col-target",children:e.jsxs("select",{value:l.targetField||"",onChange:h=>t(d,h.target.value||null),className:l.targetField?"":"unmapped",children:[e.jsx("option",{value:"",children:"-- Skip --"}),os.filter(Boolean).map(h=>e.jsx("option",{value:h,children:Be[h]},h))]})})]},d))]}),s.columnMappings.some(l=>l.targetField==="fullName")&&e.jsxs("div",{className:"info-message",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),'Full names will be automatically split on the first space (e.g., "John Smith" â†’ First: "John", Last: "Smith")']})]})}function ms(s,a){return s.map(n=>{const t={};return a.forEach((i,l)=>{const d=n[l]?.trim();if(!(!d||!i.targetField))if(i.targetField==="fullName"){const{firstName:h,lastName:m}=rs(d);t.firstName=h,t.lastName=m}else i.targetField==="rsvpStatus"?t.rsvpStatus=us(d):i.targetField==="dietaryRestrictions"||i.targetField==="accessibilityNeeds"||i.targetField==="interests"?t[i.targetField]=d.split(",").map(h=>h.trim()).filter(Boolean):t[i.targetField]=d}),t})}function us(s){const a=s.toLowerCase().trim();return["confirmed","yes","attending","accepted","y","1","true"].includes(a)?"confirmed":["declined","no","not attending","rejected","n","0","false"].includes(a)?"declined":"pending"}function hs(s){const a=[];return s.forEach((n,t)=>{n.firstName?.trim()||a.push({rowIndex:t,field:"firstName",message:"Missing first name",severity:"error"}),n.lastName?.trim()||a.push({rowIndex:t,field:"lastName",message:"Missing last name",severity:"warning"}),n.email&&!ps(n.email)&&a.push({rowIndex:t,field:"email",message:"Invalid email format",severity:"warning"})}),a}function ps(s){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)}const Z=20;function gs({state:s,dispatch:a}){const[n,t]=f.useState(0),[i,l]=f.useState(!1),d=f.useMemo(()=>{const o=new Map;return s.validationErrors.forEach(x=>{const b=o.get(x.rowIndex)||[];o.set(x.rowIndex,[...b,x])}),o},[s.validationErrors]),h=f.useMemo(()=>i?s.parsedGuests.map((o,x)=>({guest:o,index:x})).filter(({index:o})=>d.has(o)):s.parsedGuests.map((o,x)=>({guest:o,index:x})),[s.parsedGuests,i,d]),m=Math.ceil(h.length/Z),g=h.slice(n*Z,(n+1)*Z),p=o=>{a({type:"TOGGLE_EXCLUDE_ROW",payload:o})},c=s.validationErrors.filter(o=>o.severity==="error").length,u=s.validationErrors.filter(o=>o.severity==="warning").length,r=s.parsedGuests.length-s.excludedRowIndices.size;return e.jsxs("div",{className:"data-preview-step",children:[e.jsx("div",{className:"step-description",children:e.jsx("p",{children:"Review your data before importing. Uncheck rows you want to exclude."})}),e.jsxs("div",{className:"preview-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:r}),e.jsx("span",{className:"stat-label",children:"guests to import"})]}),c>0&&e.jsxs("div",{className:"stat error",children:[e.jsx("span",{className:"stat-value",children:c}),e.jsx("span",{className:"stat-label",children:"errors"})]}),u>0&&e.jsxs("div",{className:"stat warning",children:[e.jsx("span",{className:"stat-value",children:u}),e.jsx("span",{className:"stat-label",children:"warnings"})]}),s.excludedRowIndices.size>0&&e.jsxs("div",{className:"stat excluded",children:[e.jsx("span",{className:"stat-value",children:s.excludedRowIndices.size}),e.jsx("span",{className:"stat-label",children:"excluded"})]})]}),(c>0||u>0)&&e.jsx("div",{className:"filter-bar",children:e.jsxs("label",{className:"filter-checkbox",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:o=>{l(o.target.checked),t(0)}}),"Show only rows with issues"]})}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"col-include",children:"Include"}),e.jsx("th",{className:"col-row",children:"#"}),e.jsx("th",{className:"col-name",children:"Name"}),e.jsx("th",{className:"col-email",children:"Email"}),e.jsx("th",{className:"col-group",children:"Group"}),e.jsx("th",{className:"col-status",children:"Issues"})]})}),e.jsx("tbody",{children:g.map(({guest:o,index:x})=>{const b=d.get(x)||[],E=s.excludedRowIndices.has(x),A=b.some(N=>N.severity==="error"),R=b.some(N=>N.severity==="warning");return e.jsxs("tr",{className:`
                    ${E?"excluded":""}
                    ${A?"has-error":""}
                    ${R&&!A?"has-warning":""}
                  `,children:[e.jsx("td",{className:"col-include",children:e.jsx("input",{type:"checkbox",checked:!E,onChange:()=>p(x),"aria-label":`Include row ${x+1}`})}),e.jsx("td",{className:"col-row",children:x+1}),e.jsx("td",{className:"col-name",children:o.firstName||o.lastName?_({firstName:o.firstName||"",lastName:o.lastName||""}):e.jsx("em",{className:"empty",children:"No name"})}),e.jsx("td",{className:"col-email",children:o.email||e.jsx("em",{className:"empty",children:"â€”"})}),e.jsx("td",{className:"col-group",children:o.group||e.jsx("em",{className:"empty",children:"â€”"})}),e.jsx("td",{className:"col-status",children:b.length>0?e.jsx("div",{className:"issues",children:b.map((N,y)=>e.jsx("span",{className:`issue-badge ${N.severity}`,title:N.message,children:N.message},y))}):e.jsx("span",{className:"ok-badge",children:"OK"})})]},x)})})]})}),m>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn-icon",onClick:()=>t(o=>Math.max(0,o-1)),disabled:n===0,"aria-label":"Previous page",children:"â†"}),e.jsxs("span",{className:"page-info",children:["Page ",n+1," of ",m]}),e.jsx("button",{className:"btn-icon",onClick:()=>t(o=>Math.min(m-1,o+1)),disabled:n===m-1,"aria-label":"Next page",children:"â†’"})]})]})}function ue(s,a,n,t){const i=new Map;if(a===0||t==="skip")return i;for(let l=0;l<a;l++)i.set(l,[]);switch(t){case"even":xs(s,i,n);break;case"groups":case"optimized":fs(s,i,n);break}return i}function xs(s,a,n){let t=0;const i=a.size;s.forEach(l=>{const d=_({firstName:l.firstName||"",lastName:l.lastName||""});let h=0;for(;h<i;){const m=a.get(t)||[];if(m.length<n){m.push(d),a.set(t,m),t=(t+1)%i;break}t=(t+1)%i,h++}})}function fs(s,a,n){const t=a.size,i=new Map,l=[];s.forEach(m=>{if(m.group){const g=i.get(m.group)||[];g.push(m),i.set(m.group,g)}else l.push(m)});const d=Array.from(i.entries()).sort((m,g)=>g[1].length-m[1].length);let h=0;for(const[,m]of d){let g=h,p=-1;for(let u=0;u<t;u++){const r=a.get(u)||[],o=n-r.length;if(o>=m.length&&o>p){g=u,p=o;break}o>p&&(g=u,p=o)}let c=g;for(const u of m){const r=_({firstName:u.firstName||"",lastName:u.lastName||""});let o=0;for(;o<t;){const x=a.get(c)||[];if(x.length<n){x.push(r),a.set(c,x);break}c=(c+1)%t,o++}}h=(g+1)%t}for(const m of l){const g=_({firstName:m.firstName||"",lastName:m.lastName||""});let p=0,c=0;for(;c<t;){const u=a.get(p)||[];if(u.length<n){u.push(g),a.set(p,u);break}p=(p+1)%t,c++}}}function bs(s,a,n,t){const i=new Map;if(a===0||t==="skip")return i;const l=new Map;s.forEach((m,g)=>{const p=_({firstName:m.firstName||"",lastName:m.lastName||""}),c=l.get(p)||[];c.push(g),l.set(p,c)});const d=ue(s,a,n,t),h=new Set;return d.forEach((m,g)=>{m.forEach(p=>{const c=l.get(p)||[];for(const u of c)if(!h.has(u)){i.set(u,g),h.add(u);break}})}),i}function Ns(s,a,n){const t=[];if(s===0)return t;const i=Math.ceil(Math.sqrt(s)),l=a*.8,d=n*.8,h=150,m=150;for(let g=0;g<s;g++){const p=g%i,c=Math.floor(g/i);t.push({x:h+p*(a+l),y:m+c*(n+d)})}return t}function js({state:s,dispatch:a}){const n=f.useMemo(()=>s.parsedGuests.filter((c,u)=>!s.excludedRowIndices.has(u)),[s.parsedGuests,s.excludedRowIndices]),t=n.length,i=f.useMemo(()=>{const c=new Set;return n.forEach(u=>{u.group&&c.add(u.group)}),Array.from(c)},[n]),l=f.useMemo(()=>t===0||s.tableAssignment.tableCapacity===0?1:Math.ceil(t/s.tableAssignment.tableCapacity),[t,s.tableAssignment.tableCapacity]);f.useEffect(()=>{s.tableAssignment.enabled&&s.tableAssignment.tableCount===0&&a({type:"SET_TABLE_COUNT",payload:l})},[s.tableAssignment.enabled,s.tableAssignment.tableCount,l,a]),f.useEffect(()=>{if(!s.tableAssignment.enabled||s.tableAssignment.distributionStrategy==="skip"){a({type:"SET_TABLE_ASSIGNMENT_PREVIEW",payload:new Map});return}const c=ue(n,s.tableAssignment.tableCount,s.tableAssignment.tableCapacity,s.tableAssignment.distributionStrategy);a({type:"SET_TABLE_ASSIGNMENT_PREVIEW",payload:c})},[n,s.tableAssignment.enabled,s.tableAssignment.tableCount,s.tableAssignment.tableCapacity,s.tableAssignment.distributionStrategy,a]);const d=f.useCallback(c=>{a({type:"SET_TABLE_ASSIGNMENT_ENABLED",payload:c}),c&&s.tableAssignment.tableCount===0&&a({type:"SET_TABLE_COUNT",payload:l})},[a,s.tableAssignment.tableCount,l]),h=f.useCallback(c=>{a({type:"SET_TABLE_SHAPE",payload:c});const u=B[c].capacity;if(u>0&&t>0){const r=Math.ceil(t/u);a({type:"SET_TABLE_COUNT",payload:r})}},[a,t]),m=f.useCallback(c=>{if(a({type:"SET_TABLE_CAPACITY",payload:c}),c>0&&t>0){const u=Math.ceil(t/c);a({type:"SET_TABLE_COUNT",payload:u})}},[a,t]),g=Object.keys(ie),p=Object.keys(Y);return e.jsxs("div",{className:"table-assignment-step",children:[e.jsx("div",{className:"step-description",children:e.jsx("p",{children:"Optionally create tables and assign imported guests to them."})}),e.jsxs("div",{className:"assignment-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:t}),e.jsx("span",{className:"stat-label",children:"guests to import"})]}),i.length>0&&e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:i.length}),e.jsx("span",{className:"stat-label",children:"groups detected"})]})]}),e.jsxs("div",{className:"assignment-toggle",children:[e.jsxs("label",{className:"toggle-option",children:[e.jsx("input",{type:"radio",name:"assignment-mode",checked:!s.tableAssignment.enabled,onChange:()=>d(!1)}),e.jsxs("div",{className:"toggle-content",children:[e.jsx("span",{className:"toggle-label",children:"Skip table assignment"}),e.jsx("span",{className:"toggle-desc",children:"Import guests without creating tables"})]})]}),e.jsxs("label",{className:"toggle-option",children:[e.jsx("input",{type:"radio",name:"assignment-mode",checked:s.tableAssignment.enabled,onChange:()=>d(!0)}),e.jsxs("div",{className:"toggle-content",children:[e.jsx("span",{className:"toggle-label",children:"Create tables and assign guests"}),e.jsx("span",{className:"toggle-desc",children:"Configure tables and distribution below"})]})]})]}),s.tableAssignment.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Table Configuration"}),e.jsxs("div",{className:"config-grid",children:[e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"table-shape",children:"Table Shape"}),e.jsx("select",{id:"table-shape",value:s.tableAssignment.tableShape,onChange:c=>h(c.target.value),children:g.map(c=>e.jsxs("option",{value:c,children:[ie[c]," (",B[c].capacity," ","seats)"]},c))})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"table-capacity",children:"Seats per Table"}),e.jsx("input",{id:"table-capacity",type:"number",min:"1",max:"20",value:s.tableAssignment.tableCapacity,onChange:c=>m(Number(c.target.value))})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"table-count",children:"Number of Tables"}),e.jsxs("div",{className:"input-with-hint",children:[e.jsx("input",{id:"table-count",type:"number",min:"1",max:"100",value:s.tableAssignment.tableCount,onChange:c=>a({type:"SET_TABLE_COUNT",payload:Number(c.target.value)})}),e.jsxs("span",{className:"field-hint",children:["Recommended: ",l]})]})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Distribution Strategy"}),e.jsx("div",{className:"strategy-options",children:p.map(c=>e.jsxs("label",{className:`strategy-option ${s.tableAssignment.distributionStrategy===c?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"distribution-strategy",value:c,checked:s.tableAssignment.distributionStrategy===c,onChange:()=>a({type:"SET_DISTRIBUTION_STRATEGY",payload:c})}),e.jsxs("div",{className:"strategy-content",children:[e.jsx("span",{className:"strategy-label",children:Y[c].label}),e.jsx("span",{className:"strategy-desc",children:Y[c].description})]})]},c))}),s.tableAssignment.distributionStrategy==="groups"&&i.length===0&&e.jsxs("div",{className:"warning-message",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),'No group data found. Make sure you mapped a "Group" column, or use a different strategy.']})]}),s.tableAssignment.distributionStrategy!=="skip"&&s.tableAssignmentPreview.size>0&&e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Assignment Preview"}),e.jsx("div",{className:"assignment-preview",children:Array.from(s.tableAssignmentPreview.entries()).map(([c,u])=>e.jsxs("div",{className:"preview-table",children:[e.jsxs("div",{className:"preview-table-header",children:[e.jsxs("span",{className:"preview-table-name",children:["Table ",c+1]}),e.jsxs("span",{className:"preview-table-count",children:[u.length,"/",s.tableAssignment.tableCapacity]})]}),e.jsxs("div",{className:"preview-guests",children:[u.slice(0,5).map((r,o)=>e.jsx("span",{className:"preview-guest",children:r},o)),u.length>5&&e.jsxs("span",{className:"preview-more",children:["+",u.length-5," more"]})]})]},c))})]})]})]})}function vs({state:s,dispatch:a}){const n=(i,l)=>{a({type:"SET_DUPLICATE_RESOLUTION",payload:{index:i,resolution:l}})},t=i=>{a({type:"SET_ALL_DUPLICATE_RESOLUTIONS",payload:i})};return s.duplicates.length===0?e.jsx("div",{className:"duplicate-review-step",children:e.jsxs("div",{className:"no-duplicates",children:[e.jsx("div",{className:"success-icon",children:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),e.jsx("h3",{children:"No Duplicates Found"}),e.jsx("p",{children:"All guests in your import file appear to be new."})]})}):e.jsxs("div",{className:"duplicate-review-step",children:[e.jsx("div",{className:"step-description",children:e.jsxs("p",{children:["We found ",e.jsx("strong",{children:s.duplicates.length})," potential duplicate",s.duplicates.length===1?"":"s",". Choose how to handle each one."]})}),e.jsxs("div",{className:"bulk-actions",children:[e.jsx("span",{children:"Apply to all:"}),e.jsx("button",{className:"btn-small",onClick:()=>t("import"),children:"Import All as New"}),e.jsx("button",{className:"btn-small",onClick:()=>t("merge"),children:"Merge All"}),e.jsx("button",{className:"btn-small",onClick:()=>t("skip"),children:"Skip All"})]}),e.jsx("div",{className:"duplicates-list",children:s.duplicates.map((i,l)=>{const d=s.duplicateResolutions.get(l)||"import";return e.jsxs("div",{className:`duplicate-card ${d}`,children:[e.jsx("div",{className:"duplicate-header",children:e.jsxs("div",{className:"match-info",children:[e.jsxs("span",{className:"match-score",children:[Math.round(i.matchScore*100),"% match"]}),e.jsx("span",{className:"match-reasons",children:i.matchReasons.join(" â€¢ ")})]})}),e.jsxs("div",{className:"duplicate-comparison",children:[e.jsxs("div",{className:"guest-card new",children:[e.jsx("h4",{children:"New Guest (from file)"}),e.jsxs("div",{className:"guest-info",children:[e.jsx("p",{className:"guest-name",children:_({firstName:i.newGuest.firstName||"",lastName:i.newGuest.lastName||""})}),i.newGuest.email&&e.jsx("p",{className:"guest-detail",children:i.newGuest.email}),i.newGuest.company&&e.jsx("p",{className:"guest-detail",children:i.newGuest.company}),i.newGuest.group&&e.jsxs("p",{className:"guest-detail",children:["Group: ",i.newGuest.group]})]})]}),e.jsx("div",{className:"vs-divider",children:e.jsx("span",{children:"vs"})}),e.jsxs("div",{className:"guest-card existing",children:[e.jsx("h4",{children:"Existing Guest"}),e.jsxs("div",{className:"guest-info",children:[e.jsx("p",{className:"guest-name",children:_(i.existingGuest)}),i.existingGuest.email&&e.jsx("p",{className:"guest-detail",children:i.existingGuest.email}),i.existingGuest.company&&e.jsx("p",{className:"guest-detail",children:i.existingGuest.company}),i.existingGuest.group&&e.jsxs("p",{className:"guest-detail",children:["Group: ",i.existingGuest.group]}),i.existingGuest.tableId&&e.jsx("p",{className:"guest-detail assigned",children:"Already assigned to a table"})]})]})]}),e.jsxs("div",{className:"resolution-actions",children:[e.jsxs("label",{className:`resolution-option ${d==="skip"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:`resolution-${l}`,value:"skip",checked:d==="skip",onChange:()=>n(l,"skip")}),e.jsx("span",{className:"option-label",children:"Skip"}),e.jsx("span",{className:"option-desc",children:"Don't import this guest"})]}),e.jsxs("label",{className:`resolution-option ${d==="merge"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:`resolution-${l}`,value:"merge",checked:d==="merge",onChange:()=>n(l,"merge")}),e.jsx("span",{className:"option-label",children:"Merge"}),e.jsx("span",{className:"option-desc",children:"Update existing with new data"})]}),e.jsxs("label",{className:`resolution-option ${d==="import"?"selected":""}`,children:[e.jsx("input",{type:"radio",name:`resolution-${l}`,value:"import",checked:d==="import",onChange:()=>n(l,"import")}),e.jsx("span",{className:"option-label",children:"Import as New"}),e.jsx("span",{className:"option-desc",children:"Create separate guest record"})]})]})]},l)})})]})}const ys=.7;function ws(s,a){const n=[];for(let t=0;t<s.length;t++){const i=s[t];for(const l of a){const{score:d,reasons:h}=Es(i,l);if(d>=ys){n.push({newGuestIndex:t,newGuest:i,existingGuest:l,matchScore:d,matchReasons:h});break}}}return n}function Es(s,a){const n=[];let t=0,i=0;s.email&&a.email&&(i+=.5,oe(s.email)===oe(a.email)&&(t+=.5,n.push("Same email")));const l=`${s.firstName||""} ${s.lastName||""}`.toLowerCase().trim(),d=_(a).toLowerCase();if(l&&d){i+=.35;const m=q(l,d);m>.85&&(t+=.35*m,m>.95?n.push("Same name"):n.push("Similar name"))}return s.company&&a.company&&(i+=.15,q(s.company.toLowerCase(),a.company.toLowerCase())>.9&&q(l,d)>.7&&(t+=.15,n.push("Same company"))),{score:i>0?t/i:0,reasons:n}}function oe(s){return s.toLowerCase().trim()}function q(s,a){if(s===a)return 1;if(!s||!a)return 0;const n=Ss(s,a),t=Math.max(s.length,a.length);return 1-n/t}function Ss(s,a){const n=[];for(let t=0;t<=a.length;t++)n[t]=[t];for(let t=0;t<=s.length;t++)n[0][t]=t;for(let t=1;t<=a.length;t++)for(let i=1;i<=s.length;i++)a.charAt(t-1)===s.charAt(i-1)?n[t][i]=n[t-1][i-1]:n[t][i]=Math.min(n[t-1][i-1]+1,n[t][i-1]+1,n[t-1][i]+1);return n[a.length][s.length]}function de(s){return new Set(s.map(a=>a.newGuestIndex))}const me=[{id:"upload",title:"Upload File"},{id:"mapping",title:"Map Columns"},{id:"preview",title:"Preview Data"},{id:"tables",title:"Table Assignment"},{id:"duplicates",title:"Review Duplicates"}];function $s({isOpen:s,onClose:a}){const[n,t]=f.useReducer(De,X),{event:i,importGuests:l,updateGuest:d,addTables:h,assignGuestToTable:m}=O(),g=f.useMemo(()=>n.duplicates.length===0?me.filter(N=>N.id!=="duplicates"):me,[n.duplicates.length]),[p,c]=f.useReducer((N,y)=>y==="next"?Math.min(N+1,g.length-1):y==="back"?Math.max(N-1,0):y,0),u=g[p];f.useEffect(()=>{if(!s)return;const N=y=>{y.key==="Escape"&&a()};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[s,a]),f.useEffect(()=>{s||(t({type:"RESET"}),c(0))},[s]);const r=f.useCallback(()=>{switch(u?.id){case"upload":return n.parsedFile!==null&&n.fileError===null;case"mapping":return is(n.columnMappings);case"preview":return n.parsedGuests.filter((y,C)=>!n.excludedRowIndices.has(C)).length>0;case"tables":return n.tableAssignment.enabled?n.tableAssignment.tableCount>0:!0;case"duplicates":return!0;default:return!1}},[u?.id,n]),o=f.useCallback(()=>{if(u?.id==="preview"){const N=n.parsedGuests.filter((T,k)=>!n.excludedRowIndices.has(k)),y=B.round.capacity,C=Math.ceil(N.length/y);n.tableAssignment.tableCount===0&&t({type:"SET_TABLE_COUNT",payload:C})}if(u?.id==="tables"){const N=n.parsedGuests.filter((C,T)=>!n.excludedRowIndices.has(T)),y=ws(N,i.guests);t({type:"SET_DUPLICATES",payload:y}),t({type:"SET_ALL_DUPLICATE_RESOLUTIONS",payload:"import"})}c("next")},[u?.id,n.parsedGuests,n.excludedRowIndices,n.tableAssignment.tableCount,i.guests]),x=f.useCallback(()=>{c("back")},[]),b=f.useCallback(()=>{const N=n.parsedGuests.filter((S,w)=>!n.excludedRowIndices.has(w)),y=de(n.duplicates);let C=0,T=0,k=0;return N.forEach((S,w)=>{if(y.has(w)){const P=n.duplicateResolutions.get(w)||"import";P==="skip"?k++:P==="merge"?T++:C++}else C++}),{toAdd:C,toMerge:T,toSkip:k,total:N.length}},[n.parsedGuests,n.excludedRowIndices,n.duplicates,n.duplicateResolutions]),E=f.useCallback(()=>{t({type:"SET_IMPORTING",payload:!0});try{const N=n.parsedGuests.filter(($,j)=>!n.excludedRowIndices.has(j)),y=de(n.duplicates);let C=[];if(n.tableAssignment.enabled&&n.tableAssignment.tableCount>0){const{tableShape:$,tableCount:j,tableCapacity:I}=n.tableAssignment,M=B[$],G=Ns(j,M.width,M.height).map(F=>({shape:$,x:F.x,y:F.y,capacity:I}));C=h(G)}let T=new Map;n.tableAssignment.enabled&&n.tableAssignment.distributionStrategy!=="skip"&&C.length>0&&(T=bs(N,n.tableAssignment.tableCount,n.tableAssignment.tableCapacity,n.tableAssignment.distributionStrategy));const k=[],S=[],w=[];if(N.forEach(($,j)=>{if(y.has(j)){const I=n.duplicates.find(L=>L.newGuestIndex===j),M=n.duplicateResolutions.get(j)||"import";if(M!=="skip")if(M==="merge"&&I){const L=T.get(j),G=L!==void 0?C[L]:void 0;S.push({id:I.existingGuest.id,data:G?{...$,tableId:G}:$})}else w.push(j),k.push($)}else w.push(j),k.push($)}),k.length>0&&l(k),S.forEach(({id:$,data:j})=>{d($,j)}),C.length>0&&T.size>0){const $=O.getState().event.guests;k.forEach((j,I)=>{const M=w[I],L=T.get(M);if(L!==void 0&&C[L]){const G=$.find(F=>F.firstName===j.firstName&&F.lastName===j.lastName&&!F.tableId);G&&m(G.id,C[L])}})}const P=b();let z=`Imported ${P.toAdd} new guest${P.toAdd!==1?"s":""}`;P.toMerge>0&&(z+=`, merged ${P.toMerge}`),n.tableAssignment.enabled&&n.tableAssignment.tableCount>0&&(z+=`, created ${n.tableAssignment.tableCount} table${n.tableAssignment.tableCount!==1?"s":""}`),K(z,"success"),a()}catch(N){t({type:"SET_IMPORT_ERROR",payload:N instanceof Error?N.message:"Import failed"}),K("Import failed. Please try again.","error")}finally{t({type:"SET_IMPORTING",payload:!1})}},[n.parsedGuests,n.excludedRowIndices,n.duplicates,n.duplicateResolutions,n.tableAssignment,l,d,h,m,b,a]),A=p===g.length-1;if(!s)return null;const R=b();return J.createPortal(e.jsx("div",{className:"modal-overlay import-wizard-overlay",onClick:a,children:e.jsxs("div",{className:"import-wizard-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"wizard-header",children:[e.jsx("h2",{children:"Import Guests"}),e.jsx("button",{className:"close-btn",onClick:a,"aria-label":"Close",children:"Ã—"})]}),e.jsx("div",{className:"wizard-progress",children:g.map((N,y)=>e.jsxs("div",{className:`progress-step ${y===p?"active":""} ${y<p?"completed":""}`,children:[e.jsx("span",{className:"step-number",children:y+1}),e.jsx("span",{className:"step-title",children:N.title})]},N.id))}),e.jsxs("div",{className:"wizard-content",children:[u?.id==="upload"&&e.jsx(cs,{state:n,dispatch:t}),u?.id==="mapping"&&e.jsx(ds,{state:n,dispatch:t,eventType:n.detectedEventType||i.eventType}),u?.id==="preview"&&e.jsx(gs,{state:n,dispatch:t}),u?.id==="tables"&&e.jsx(js,{state:n,dispatch:t}),u?.id==="duplicates"&&e.jsx(vs,{state:n,dispatch:t})]}),e.jsxs("div",{className:"wizard-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:x,disabled:p===0,children:"Back"}),e.jsx("div",{className:"footer-spacer"}),A?e.jsx("button",{className:"btn-primary",onClick:E,disabled:n.isImporting||R.total===0,children:n.isImporting?"Importing...":`Import ${R.toAdd} Guest${R.toAdd!==1?"s":""}`}):e.jsx("button",{className:"btn-primary",onClick:o,disabled:!r(),children:"Next"})]})]})}),document.body)}export{$s as I,As as M,_s as R};
